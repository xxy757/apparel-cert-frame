import{_ as ce,a1 as pe,g as ve,K as z,r as I,h as L,o as _e,M as me,j as y,k as i,n as _,q as t,G as o,t as s,w as a,U as B,Q as R,I as A,F,v as P,x as fe,a5 as K,D as $,E as ge,y as c,R as O,af as ye,a0 as be,c as ke,ao as xe,ap as we}from"./index-3d929bd0.js";import{r as X}from"./request-9595d616.js";const Ee={class:"exam-container"},Ce={class:"exam-header"},he={class:"exam-info"},Se={class:"info-tags"},Ie={class:"exam-timer"},Ve={class:"timer-box"},Te={class:"progress-bar"},Le={class:"progress-text"},Re={key:0,class:"question-area"},Ne={class:"question-card"},Ue={class:"question-header"},qe={class:"question-number"},Oe={class:"question-score"},Ae={class:"question-content"},Me={class:"question-text"},He={key:0,class:"answer-area"},Qe={class:"option-key"},ze={class:"option-text"},Be={key:1,class:"answer-area"},Fe={class:"option-key"},Pe={class:"option-text"},$e={key:2,class:"answer-area"},De={key:3,class:"answer-area"},Ge={class:"navigation-buttons"},je={class:"question-nav-panel"},We={class:"question-nav-grid"},Je=["onClick"],Ke={class:"submit-dialog-content"},Xe={class:"submit-stats"},Ye={key:0,class:"submit-warning"},Ze={class:"result-dialog-content"},et={class:"score-circle"},tt={class:"score-value"},st={class:"result-status"},at={class:"result-details"},ot={__name:"Exam",setup(lt){const D=pe(),Y=ve(),p=z({title:"服装设计师（中级）理论考试",category:"服装设计",level:"中级",totalScore:100,passScore:60,duration:7200}),E=I([]),m=I(0),u=z({}),G=I(null),x=I(7200);let C=null;const N=I(!1),M=I(!1),H=I(!1),f=z({score:0,correctCount:0,passed:!1}),r=L(()=>E.value[m.value]),b=L(()=>E.value.length),U=L(()=>Object.keys(u).filter(n=>{const e=u[n];return Array.isArray(e)?e.length>0:e!==void 0&&e!==""}).length),Q=L(()=>b.value===0?0:Math.round(U.value/b.value*100)),Z=L(()=>Q.value<30?"#f56c6c":Q.value<70?"#e6a23c":"#67c23a"),ee=L(()=>{const n=Math.floor(x.value/3600),e=Math.floor(x.value%3600/60),d=x.value%60;return`${n.toString().padStart(2,"0")}:${e.toString().padStart(2,"0")}:${d.toString().padStart(2,"0")}`}),te=n=>({SINGLE_CHOICE:"单选题",MULTIPLE_CHOICE:"多选题",TRUE_FALSE:"判断题",SHORT_ANSWER:"简答题"})[n]||n,se=n=>({SINGLE_CHOICE:"",MULTIPLE_CHOICE:"warning",TRUE_FALSE:"info",SHORT_ANSWER:"success"})[n]||"",ae=n=>{const e=u[n];return Array.isArray(e)?e.length>0:e!==void 0&&e!==""},oe=()=>{m.value>0&&m.value--},le=()=>{m.value<b.value-1&&m.value++},ne=n=>{m.value=n},re=()=>{N.value=!0},j=async()=>{var n,e,d,v;H.value=!0;try{const g=Number(K("/personal")||0),k=await X.post("/exam/submit",{examRecordId:G.value,userId:g,answers:JSON.stringify(u)});f.score=((n=k.data)==null?void 0:n.score)||85,f.correctCount=((e=k.data)==null?void 0:e.correctCount)||17,f.passed=f.score>=p.passScore,N.value=!1,M.value=!0,C&&(clearInterval(C),C=null)}catch(g){$.error(((v=(d=g==null?void 0:g.response)==null?void 0:d.data)==null?void 0:v.message)||"提交试卷失败，请稍后重试")}finally{H.value=!1}},ue=()=>{Y.push("/personal/certification")},ie=async()=>{var n,e,d,v,g,k,q;try{const w=Number(K("/personal")||0),h=await X.post("/exam/generate",{userId:w,applicationId:Number(D.query.applicationId),standardId:Number(D.query.examId),questionCount:20});return G.value=((n=h.data)==null?void 0:n.examRecordId)||null,E.value=((e=h.data)==null?void 0:e.questions)||[],Object.keys(u).forEach(V=>{delete u[V]}),E.value.forEach(V=>{V.type==="MULTIPLE_CHOICE"&&(u[V.id]=[])}),p.totalScore=((d=h.data)==null?void 0:d.totalScore)||p.totalScore,p.passScore=((v=h.data)==null?void 0:v.passScore)||Math.round(p.totalScore*.6),p.duration=(((g=h.data)==null?void 0:g.duration)||60)*60,x.value=p.duration,E.value.length>0}catch(w){return console.error("加载试题失败:",w),$.error(((q=(k=w==null?void 0:w.response)==null?void 0:k.data)==null?void 0:q.message)||"试题加载失败，请稍后重试"),E.value=[],x.value=0,!1}},de=()=>{C=setInterval(()=>{x.value>0?x.value--:(clearInterval(C),ge.alert("考试时间已到，系统将自动提交试卷","时间到",{confirmButtonText:"确定",callback:()=>{j()}}))},1e3)},W=()=>{document.hidden&&$.warning("请勿切换页面，否则可能影响考试成绩")};return _e(async()=>{await ie()&&de(),document.addEventListener("visibilitychange",W)}),me(()=>{C&&clearInterval(C),document.removeEventListener("visibilitychange",W)}),(n,e)=>{const d=y("el-tag"),v=y("el-icon"),g=y("el-progress"),k=y("el-radio"),q=y("el-radio-group"),w=y("el-checkbox"),h=y("el-checkbox-group"),V=y("el-input"),T=y("el-button"),J=y("el-dialog");return i(),_("div",Ee,[t("div",Ce,[t("div",he,[t("h2",null,o(p.title),1),t("div",Se,[s(d,{type:"info"},{default:a(()=>[c(o(p.category),1)]),_:1}),s(d,{type:"warning"},{default:a(()=>[c(o(p.level),1)]),_:1}),s(d,null,{default:a(()=>[c("总分："+o(p.totalScore)+"分",1)]),_:1})])]),t("div",Ie,[t("div",Ve,[s(v,null,{default:a(()=>[s(O(ye))]),_:1}),e[7]||(e[7]=t("span",{class:"time-text"},"剩余时间",-1)),t("span",{class:B(["time-value",{"time-warning":x.value<600}])},o(ee.value),3)])])]),t("div",Te,[s(g,{percentage:Q.value,color:Z.value,"stroke-width":8},null,8,["percentage","color"]),t("span",Le,"已完成 "+o(U.value)+"/"+o(b.value)+" 题",1)]),r.value?(i(),_("div",Re,[t("div",Ne,[t("div",Ue,[t("span",qe,"第 "+o(m.value+1)+" 题",1),s(d,{type:se(r.value.type)},{default:a(()=>[c(o(te(r.value.type)),1)]),_:1},8,["type"]),t("span",Oe,o(r.value.score)+" 分",1)]),t("div",Ae,[t("p",Me,o(r.value.content),1)]),r.value.type==="SINGLE_CHOICE"?(i(),_("div",He,[s(q,{modelValue:u[r.value.id],"onUpdate:modelValue":e[0]||(e[0]=l=>u[r.value.id]=l),size:"large"},{default:a(()=>[(i(!0),_(F,null,P(r.value.options,(l,S)=>(i(),A(k,{key:S,label:l.key,class:"answer-option"},{default:a(()=>[t("span",Qe,o(l.key),1),t("span",ze,o(l.value),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])])):R("",!0),r.value.type==="MULTIPLE_CHOICE"?(i(),_("div",Be,[s(h,{modelValue:u[r.value.id],"onUpdate:modelValue":e[1]||(e[1]=l=>u[r.value.id]=l)},{default:a(()=>[(i(!0),_(F,null,P(r.value.options,(l,S)=>(i(),A(w,{key:S,label:l.key,class:"answer-option"},{default:a(()=>[t("span",Fe,o(l.key),1),t("span",Pe,o(l.value),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])])):R("",!0),r.value.type==="TRUE_FALSE"?(i(),_("div",$e,[s(q,{modelValue:u[r.value.id],"onUpdate:modelValue":e[2]||(e[2]=l=>u[r.value.id]=l),size:"large"},{default:a(()=>[s(k,{label:"true",class:"answer-option"},{default:a(()=>[...e[8]||(e[8]=[t("span",{class:"option-key"},"✓",-1),t("span",{class:"option-text"},"正确",-1)])]),_:1}),s(k,{label:"false",class:"answer-option"},{default:a(()=>[...e[9]||(e[9]=[t("span",{class:"option-key"},"✗",-1),t("span",{class:"option-text"},"错误",-1)])]),_:1})]),_:1},8,["modelValue"])])):R("",!0),r.value.type==="SHORT_ANSWER"?(i(),_("div",De,[s(V,{modelValue:u[r.value.id],"onUpdate:modelValue":e[3]||(e[3]=l=>u[r.value.id]=l),type:"textarea",rows:8,placeholder:"请输入您的答案...",maxlength:"1000","show-word-limit":""},null,8,["modelValue"])])):R("",!0)]),t("div",Ge,[s(T,{onClick:oe,disabled:m.value===0,size:"large"},{default:a(()=>[s(v,null,{default:a(()=>[s(O(be))]),_:1}),e[10]||(e[10]=c(" 上一题 ",-1))]),_:1},8,["disabled"]),m.value<b.value-1?(i(),A(T,{key:0,type:"primary",onClick:le,size:"large"},{default:a(()=>[e[11]||(e[11]=c(" 下一题 ",-1)),s(v,null,{default:a(()=>[s(O(ke))]),_:1})]),_:1})):(i(),A(T,{key:1,type:"success",onClick:re,size:"large"},{default:a(()=>[s(v,null,{default:a(()=>[s(O(xe))]),_:1}),e[12]||(e[12]=c(" 提交试卷 ",-1))]),_:1}))])])):R("",!0),t("div",je,[e[13]||(e[13]=t("h3",null,"答题卡",-1)),t("div",We,[(i(!0),_(F,null,P(E.value,(l,S)=>(i(),_("div",{key:l.id,class:B(["question-nav-item",{current:S===m.value,answered:ae(l.id)}]),onClick:nt=>ne(S)},o(S+1),11,Je))),128))]),e[14]||(e[14]=fe('<div class="nav-legend" data-v-d9012c3b><span class="legend-item" data-v-d9012c3b><i class="dot current" data-v-d9012c3b></i>当前题</span><span class="legend-item" data-v-d9012c3b><i class="dot answered" data-v-d9012c3b></i>已作答</span><span class="legend-item" data-v-d9012c3b><i class="dot unanswered" data-v-d9012c3b></i>未作答</span></div>',1))]),s(J,{modelValue:N.value,"onUpdate:modelValue":e[5]||(e[5]=l=>N.value=l),title:"提交确认",width:"500px",center:""},{footer:a(()=>[s(T,{onClick:e[4]||(e[4]=l=>N.value=!1)},{default:a(()=>[...e[17]||(e[17]=[c("继续答题",-1)])]),_:1}),s(T,{type:"primary",onClick:j,loading:H.value},{default:a(()=>[...e[18]||(e[18]=[c(" 确认提交 ",-1)])]),_:1},8,["loading"])]),default:a(()=>[t("div",Ke,[s(v,{class:"warning-icon"},{default:a(()=>[s(O(we))]),_:1}),e[16]||(e[16]=t("p",null,"您确定要提交试卷吗？",-1)),t("p",Xe,[e[15]||(e[15]=c(" 已答题目：",-1)),t("strong",null,o(U.value),1),c(" / "+o(b.value)+" 题 ",1)]),U.value<b.value?(i(),_("p",Ye," 还有 "+o(b.value-U.value)+" 道题目未作答！ ",1)):R("",!0)])]),_:1},8,["modelValue"]),s(J,{modelValue:M.value,"onUpdate:modelValue":e[6]||(e[6]=l=>M.value=l),title:"考试结果",width:"600px",center:"","close-on-click-modal":!1},{footer:a(()=>[s(T,{type:"primary",onClick:ue},{default:a(()=>[...e[20]||(e[20]=[c("返回认证中心",-1)])]),_:1})]),default:a(()=>[t("div",Ze,[t("div",{class:B(["result-score",{pass:f.passed,fail:!f.passed}])},[t("div",et,[t("span",tt,o(f.score),1),e[19]||(e[19]=t("span",{class:"score-label"},"分",-1))])],2),t("div",st,[s(d,{type:f.passed?"success":"danger",size:"large"},{default:a(()=>[c(o(f.passed?"恭喜通过！":"未通过"),1)]),_:1},8,["type"])]),t("div",at,[t("p",null,"总题数："+o(b.value)+" 题",1),t("p",null,"正确题数："+o(f.correctCount)+" 题",1),t("p",null,"及格分数："+o(p.passScore)+" 分",1)])])]),_:1},8,["modelValue"])])}}},it=ce(ot,[["__scopeId","data-v-d9012c3b"]]);export{it as default};
