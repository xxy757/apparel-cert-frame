import{_ as O,g as Q,r as A,K as C,h as z,L as G,o as H,M as J,j as F,k as w,n as L,q as b,t as r,w as n,D as k,N as W,O as X,P as Y,I as y,Q as M,y as g}from"./index-3d929bd0.js";import{r as Z}from"./request-9595d616.js";const h={name:"Login",setup(){const B=Q(),o=A(!1),U=A("personal"),e=C({username:"",password:""}),v=C({username:"",password:""}),_=C({username:"",password:""}),t=A(null),s=A(null),i=A(null),u=5,p=300,d=C({personal:0,enterprise:0,admin:0}),f=C({personal:null,enterprise:null,admin:null}),c=A(0);let a=null;const D=z(()=>{const l=U.value;return d[l]>=u&&c.value>0}),T=l=>{f[l]=Date.now(),c.value=p,a&&clearInterval(a),a=setInterval(()=>{const m=Math.floor((Date.now()-f[l])/1e3);c.value=Math.max(0,p-m),c.value<=0&&(clearInterval(a),d[l]=0,f[l]=null)},1e3)},I=l=>{if(f[l]){const m=Math.floor((Date.now()-f[l])/1e3);if(m<p)return c.value=p-m,T(l),!0;d[l]=0,f[l]=null}return!1},S={username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},N=async l=>{if(D.value){k.error(`账号已锁定，请 ${c.value} 秒后重试`);return}let m,V;if(l==="personal"?(m=t,V=e):l==="enterprise"?(m=s,V=v):l==="admin"&&(m=i,V=_),!m.value){k.error("表单未加载");return}m.value.validate(async j=>{if(!j)return k.error("请填写完整的登录信息"),!1;o.value=!0;try{const R=l==="personal"?"/auth/login/personal":l==="enterprise"?"/auth/login/enterprise":"/auth/login/admin",x=await Z.post(R,{username:V.username,password:V.password});if(x.data&&x.data.token){d[l]=0,f[l]=null;const E=W(x.data.userType)||X(l);Y(E,{token:x.data.token,userId:x.data.userId||"",username:V.username}),k.success("登录成功");const K=l==="personal"?"/personal/resume":l==="enterprise"?"/enterprise/job":"/admin/dashboard";B.replace(K)}else d[l]++,d[l]>=u?(T(l),k.error(`登录失败次数过多，账号已锁定 ${p} 秒`)):k.error(x.message||`登录失败，还剩 ${u-d[l]} 次尝试机会`)}catch(R){console.error("登录失败:",R),d[l]++,d[l]>=u&&(T(l),k.error(`登录失败次数过多，账号已锁定 ${p} 秒`))}finally{o.value=!1}})},P=l=>{l==="personalForm"?(t.value.resetFields(),e.password=""):l==="enterpriseForm"?(s.value.resetFields(),v.password=""):l==="adminForm"&&(i.value.resetFields(),_.password="")},q=()=>{e.username="",e.password="",v.username="",v.password="",_.username="",_.password="",t.value&&t.value.clearValidate(),s.value&&s.value.clearValidate(),i.value&&i.value.clearValidate()};return G(U,(l,m)=>{I(l),m==="personal"?(e.username="",e.password="",t.value&&t.value.clearValidate()):m==="enterprise"?(v.username="",v.password="",s.value&&s.value.clearValidate()):m==="admin"&&(_.username="",_.password="",i.value&&i.value.clearValidate())}),H(()=>{localStorage.removeItem("savedPassword"),localStorage.removeItem("savedUsername"),q(),I("personal"),I("enterprise"),I("admin")}),J(()=>{q(),a&&clearInterval(a)}),{activeTab:U,loading:o,personalForm:e,enterpriseForm:v,adminForm:_,personalFormRef:t,enterpriseFormRef:s,adminFormRef:i,rules:S,login:N,resetForm:P,maxAttempts:u,loginAttempts:d,lockCountdown:c,isLocked:D}}},$={class:"login-container"},ee={class:"login-box"},oe={class:"login-tabs"},le={key:0,class:"login-warning"},re={class:"login-actions"},ae={class:"login-footer"},ne={key:0,class:"login-warning"},se={class:"login-actions"},te={class:"login-footer"},ie={key:0,class:"login-warning"},de={class:"login-actions"};function me(B,o,U,e,v,_){const t=F("el-input"),s=F("el-form-item"),i=F("el-alert"),u=F("el-button"),p=F("router-link"),d=F("el-form"),f=F("el-tab-pane"),c=F("el-tabs");return w(),L("div",$,[b("div",ee,[o[23]||(o[23]=b("h2",null,"服装行业人才技能认证与招聘服务平台",-1)),b("div",oe,[r(c,{modelValue:e.activeTab,"onUpdate:modelValue":o[12]||(o[12]=a=>e.activeTab=a),type:"card"},{default:n(()=>[r(f,{label:"个人登录",name:"personal"},{default:n(()=>[r(d,{ref:"personalFormRef",model:e.personalForm,rules:e.rules,"label-width":"80px"},{default:n(()=>[r(s,{label:"用户名",prop:"username"},{default:n(()=>[r(t,{modelValue:e.personalForm.username,"onUpdate:modelValue":o[0]||(o[0]=a=>e.personalForm.username=a),placeholder:"请输入用户名",autocomplete:"off"},null,8,["modelValue"])]),_:1}),r(s,{label:"密码",prop:"password"},{default:n(()=>[r(t,{modelValue:e.personalForm.password,"onUpdate:modelValue":o[1]||(o[1]=a=>e.personalForm.password=a),type:"password",placeholder:"请输入密码",autocomplete:"new-password","show-password":""},null,8,["modelValue"])]),_:1}),e.loginAttempts.personal>0?(w(),L("div",le,[e.loginAttempts.personal<e.maxAttempts?(w(),y(i,{key:0,title:`登录失败，还剩 ${e.maxAttempts-e.loginAttempts.personal} 次尝试机会`,type:"warning",closable:!1,"show-icon":""},null,8,["title"])):(w(),y(i,{key:1,title:`账号已锁定，请 ${e.lockCountdown} 秒后重试`,type:"error",closable:!1,"show-icon":""},null,8,["title"]))])):M("",!0),r(s,null,{default:n(()=>[b("div",re,[r(u,{type:"primary",onClick:o[2]||(o[2]=a=>e.login("personal")),loading:e.loading,disabled:e.isLocked},{default:n(()=>[...o[13]||(o[13]=[g("登录",-1)])]),_:1},8,["loading","disabled"]),r(u,{onClick:o[3]||(o[3]=a=>e.resetForm("personalForm"))},{default:n(()=>[...o[14]||(o[14]=[g("重置",-1)])]),_:1})])]),_:1}),b("div",ae,[r(p,{to:"/forgot-password"},{default:n(()=>[...o[15]||(o[15]=[g("忘记密码？",-1)])]),_:1}),r(p,{to:"/register",style:{"margin-left":"20px"}},{default:n(()=>[...o[16]||(o[16]=[g("立即注册",-1)])]),_:1})])]),_:1},8,["model","rules"])]),_:1}),r(f,{label:"企业登录",name:"enterprise"},{default:n(()=>[r(d,{ref:"enterpriseFormRef",model:e.enterpriseForm,rules:e.rules,"label-width":"80px"},{default:n(()=>[r(s,{label:"用户名",prop:"username"},{default:n(()=>[r(t,{modelValue:e.enterpriseForm.username,"onUpdate:modelValue":o[4]||(o[4]=a=>e.enterpriseForm.username=a),placeholder:"请输入用户名",autocomplete:"off"},null,8,["modelValue"])]),_:1}),r(s,{label:"密码",prop:"password"},{default:n(()=>[r(t,{modelValue:e.enterpriseForm.password,"onUpdate:modelValue":o[5]||(o[5]=a=>e.enterpriseForm.password=a),type:"password",placeholder:"请输入密码",autocomplete:"new-password","show-password":""},null,8,["modelValue"])]),_:1}),e.loginAttempts.enterprise>0?(w(),L("div",ne,[e.loginAttempts.enterprise<e.maxAttempts?(w(),y(i,{key:0,title:`登录失败，还剩 ${e.maxAttempts-e.loginAttempts.enterprise} 次尝试机会`,type:"warning",closable:!1,"show-icon":""},null,8,["title"])):(w(),y(i,{key:1,title:`账号已锁定，请 ${e.lockCountdown} 秒后重试`,type:"error",closable:!1,"show-icon":""},null,8,["title"]))])):M("",!0),r(s,null,{default:n(()=>[b("div",se,[r(u,{type:"primary",onClick:o[6]||(o[6]=a=>e.login("enterprise")),loading:e.loading,disabled:e.isLocked},{default:n(()=>[...o[17]||(o[17]=[g("登录",-1)])]),_:1},8,["loading","disabled"]),r(u,{onClick:o[7]||(o[7]=a=>e.resetForm("enterpriseForm"))},{default:n(()=>[...o[18]||(o[18]=[g("重置",-1)])]),_:1})])]),_:1}),b("div",te,[r(p,{to:"/forgot-password"},{default:n(()=>[...o[19]||(o[19]=[g("忘记密码？",-1)])]),_:1}),r(p,{to:"/register",style:{"margin-left":"20px"}},{default:n(()=>[...o[20]||(o[20]=[g("立即注册",-1)])]),_:1})])]),_:1},8,["model","rules"])]),_:1}),r(f,{label:"管理员登录",name:"admin"},{default:n(()=>[r(d,{ref:"adminFormRef",model:e.adminForm,rules:e.rules,"label-width":"80px"},{default:n(()=>[r(s,{label:"用户名",prop:"username"},{default:n(()=>[r(t,{modelValue:e.adminForm.username,"onUpdate:modelValue":o[8]||(o[8]=a=>e.adminForm.username=a),placeholder:"请输入管理员用户名",autocomplete:"off"},null,8,["modelValue"])]),_:1}),r(s,{label:"密码",prop:"password"},{default:n(()=>[r(t,{modelValue:e.adminForm.password,"onUpdate:modelValue":o[9]||(o[9]=a=>e.adminForm.password=a),type:"password",placeholder:"请输入密码",autocomplete:"new-password","show-password":""},null,8,["modelValue"])]),_:1}),e.loginAttempts.admin>0?(w(),L("div",ie,[e.loginAttempts.admin<e.maxAttempts?(w(),y(i,{key:0,title:`登录失败，还剩 ${e.maxAttempts-e.loginAttempts.admin} 次尝试机会`,type:"warning",closable:!1,"show-icon":""},null,8,["title"])):(w(),y(i,{key:1,title:`账号已锁定，请 ${e.lockCountdown} 秒后重试`,type:"error",closable:!1,"show-icon":""},null,8,["title"]))])):M("",!0),r(s,null,{default:n(()=>[b("div",de,[r(u,{type:"primary",onClick:o[10]||(o[10]=a=>e.login("admin")),loading:e.loading,disabled:e.isLocked},{default:n(()=>[...o[21]||(o[21]=[g("登录",-1)])]),_:1},8,["loading","disabled"]),r(u,{onClick:o[11]||(o[11]=a=>e.resetForm("adminForm"))},{default:n(()=>[...o[22]||(o[22]=[g("重置",-1)])]),_:1})])]),_:1})]),_:1},8,["model","rules"])]),_:1})]),_:1},8,["modelValue"])])])])}const fe=O(h,[["render",me],["__scopeId","data-v-224d0302"]]);export{fe as default};
