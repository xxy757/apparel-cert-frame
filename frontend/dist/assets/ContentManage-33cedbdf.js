import{_ as te,a7 as ne,d as le,aM as oe,ak as ae,am as se,ah as ie,u as re,af as de,aa as ue,aN as ce,r as b,K as ee,h as E,o as me,D as h,j as r,k,n as X,q as a,t as e,w as l,G as p,E as Y,y as d,I as L,Q as R,F as pe}from"./index-3d929bd0.js";import{r as x}from"./request-9595d616.js";const _e={name:"ContentManage",components:{Bell:ne,Document:le,Promotion:oe,View:ae,Plus:se,Search:ie,User:re,Clock:de,Link:ue,Picture:ce},setup(){const j=b(null),t=b(!1),P=b(!1),n=b(!1),H=b({}),I=b("all"),T=ee({title:"",contentType:"",status:""}),s=ee({id:null,title:"",contentType:"notice",author:"",summary:"",content:"",status:"1",isTop:!1,sourceUrl:"",sourceName:"",coverImage:"",tags:[]}),S={title:[{required:!0,message:"请输入内容标题",trigger:"blur"},{min:5,max:100,message:"长度在 5 到 100 个字符",trigger:"blur"}],contentType:[{required:!0,message:"请选择内容类型",trigger:"change"}],author:[{required:!0,message:"请输入作者",trigger:"blur"}],summary:[{required:!0,message:"请输入内容摘要",trigger:"blur"},{min:10,max:200,message:"长度在 10 到 200 个字符",trigger:"blur"}],content:[{required:!0,message:"请输入内容详情",trigger:"blur"}],status:[{required:!0,message:"请选择内容状态",trigger:"change"}]},g=b([]),F=b(1),V=b(10),B=b(0),q={notice:1,article:2,news:4},m={1:"notice",2:"article",3:"article",4:"news"},C=()=>({id:s.id||void 0,title:s.title,content:s.content,type:q[s.contentType]||1,status:Number(s.status),isTop:s.isTop?1:0,publisherName:s.author,coverImage:s.contentType==="news"?s.coverImage:void 0}),u=E(()=>g.value.filter(i=>i.contentType==="notice").length),c=E(()=>g.value.filter(i=>i.contentType==="article").length),U=E(()=>g.value.filter(i=>i.contentType==="news").length),A=E(()=>g.value.reduce((i,f)=>i+(f.viewCount||0),0));me(()=>{_()});const _=async()=>{try{const i=I.value==="all"?void 0:q[I.value],f=await x.get("/announcement/admin/list",{params:{page:F.value,size:V.value,type:i,keyword:T.title||void 0,status:T.status||void 0}});g.value=(f.data.records||[]).map(y=>({...y,contentType:m[y.type]||"notice",author:y.publisherName||y.author||"",viewCount:y.views||0,createTime:y.publishTime||y.createTime,summary:y.summary||(y.content?y.content.slice(0,120):"")})),B.value=f.data.total||0}catch(i){console.error("加载内容失败:",i),h.error("加载内容失败"),g.value=[],B.value=0}},v=()=>{_()},D=()=>{_()},G=()=>{T.title="",T.status="",_()},K=i=>({article:"文章",notice:"公告",news:"动态"})[i]||"未知",O=i=>({article:"",notice:"warning",news:"success"})[i]||"info",w=i=>i===1?"已发布":"草稿",z=i=>i===1?"success":"info",Q=()=>{s.id=null,s.title="",s.contentType="notice",s.author="",s.summary="",s.content="",s.status="1",s.isTop=!1,s.sourceUrl="",s.sourceName="",s.coverImage="",s.tags=[]},J=()=>{n.value=!1,Q(),t.value=!0},W=()=>{s.status="0",M()},M=async()=>{j.value.validate(async i=>{if(i)try{const f=C();n.value?await x.put("/announcement",f):Number(s.status)===1?await x.post("/announcement/publish",f):await x.post("/announcement/draft",f),n.value?h.success("内容修改成功"):h.success(s.status==="1"?"内容发布成功":"草稿保存成功"),t.value=!1,_()}catch(f){console.error("保存内容失败:",f),h.error("保存失败，请稍后重试")}else return!1})};return{contentFormRef:j,createContentDialogVisible:t,detailDialogVisible:P,isEditing:n,selectedContent:H,activeTab:I,searchForm:T,contentForm:s,contentRules:S,contents:g,currentPage:F,pageSize:V,totalContents:B,noticeCount:u,articleCount:c,newsCount:U,totalViews:A,handleTabChange:v,getContentTypeText:K,getContentTypeTagType:O,getStatusText:w,getStatusTagType:z,openCreateContentDialog:J,saveDraft:W,createContent:M,searchContents:D,resetSearch:G,viewContentDetails:i=>{H.value=i,P.value=!0},editContent:i=>{n.value=!0,Object.assign(s,{id:i.id,title:i.title,contentType:i.contentType,author:i.author,summary:i.summary,content:i.content,status:String(i.status),isTop:i.isTop}),P.value=!1,t.value=!0},publishContent:i=>{Y.confirm("确定要发布该内容吗？","发布确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}).then(async()=>{await x.put("/announcement",{id:i.id,status:1}),h.success("内容已发布"),_()}).catch(()=>{})},unpublishContent:i=>{Y.confirm("确定要下架该内容吗？","下架确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{await x.put("/announcement/offline",null,{params:{announcementId:i.id}}),h.success("内容已下架"),_()}).catch(()=>{})},deleteContent:i=>{Y.confirm("确定要删除该内容吗？此操作不可恢复。","删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"error"}).then(async()=>{await x.delete("/announcement",{params:{announcementId:i.id}}),h.success("内容已删除"),_()}).catch(()=>{})},handleSizeChange:i=>{V.value=i,_()},handleCurrentChange:i=>{F.value=i,_()}}}},fe={class:"content-manage-container"},ge={class:"stats-cards"},Ce={class:"stat-card"},ve={class:"stat-icon notice-icon"},ye={class:"stat-info"},be={class:"stat-value"},we={class:"stat-card"},Te={class:"stat-icon article-icon"},Ve={class:"stat-info"},he={class:"stat-value"},ke={class:"stat-card"},xe={class:"stat-icon news-icon"},Fe={class:"stat-info"},Ue={class:"stat-value"},De={class:"stat-card"},Se={class:"stat-icon view-icon"},Be={class:"stat-info"},ze={class:"stat-value"},Me={class:"card-header"},Ne={class:"header-left"},Pe={class:"content-filters"},Ie={class:"title-cell"},qe={class:"title-text"},Ee={class:"view-count"},Le={class:"pagination-container"},Re={class:"dialog-footer"},je={key:0,class:"content-detail"},He={class:"detail-meta"},Ae={class:"meta-item"},Ge={class:"meta-item"},Ke={class:"meta-item"},Oe={class:"detail-summary"},Qe={class:"detail-content"},Je=["innerHTML"],We={class:"dialog-footer"};function Xe(j,t,P,n,H,I){const T=r("Bell"),s=r("el-icon"),S=r("Document"),g=r("Promotion"),F=r("View"),V=r("el-radio-button"),B=r("el-radio-group"),q=r("Plus"),m=r("el-button"),C=r("el-input"),u=r("el-form-item"),c=r("el-option"),U=r("el-select"),A=r("Search"),_=r("el-form"),v=r("el-table-column"),D=r("el-tag"),G=r("el-table"),K=r("el-pagination"),O=r("el-card"),w=r("el-col"),z=r("el-row"),Q=r("el-switch"),J=r("Link"),W=r("Picture"),M=r("el-dialog"),Z=r("User"),$=r("Clock");return k(),X("div",fe,[t[45]||(t[45]=a("div",{class:"page-header"},[a("h2",null,"内容管理"),a("p",null,"管理系统公告、行业动态和平台资讯")],-1)),a("div",ge,[a("div",Ce,[a("div",ve,[e(s,null,{default:l(()=>[e(T)]),_:1})]),a("div",ye,[a("span",be,p(n.noticeCount),1),t[19]||(t[19]=a("span",{class:"stat-label"},"系统公告",-1))])]),a("div",we,[a("div",Te,[e(s,null,{default:l(()=>[e(S)]),_:1})]),a("div",Ve,[a("span",he,p(n.articleCount),1),t[20]||(t[20]=a("span",{class:"stat-label"},"文章资讯",-1))])]),a("div",ke,[a("div",xe,[e(s,null,{default:l(()=>[e(g)]),_:1})]),a("div",Fe,[a("span",Ue,p(n.newsCount),1),t[21]||(t[21]=a("span",{class:"stat-label"},"行业动态",-1))])]),a("div",De,[a("div",Se,[e(s,null,{default:l(()=>[e(F)]),_:1})]),a("div",Be,[a("span",ze,p(n.totalViews),1),t[22]||(t[22]=a("span",{class:"stat-label"},"总浏览量",-1))])])]),e(O,{shadow:"hover",class:"main-card"},{header:l(()=>[a("div",Me,[a("div",Ne,[e(B,{modelValue:n.activeTab,"onUpdate:modelValue":t[0]||(t[0]=o=>n.activeTab=o),onChange:n.handleTabChange},{default:l(()=>[e(V,{label:"all"},{default:l(()=>[...t[23]||(t[23]=[d("全部",-1)])]),_:1}),e(V,{label:"notice"},{default:l(()=>[...t[24]||(t[24]=[d("公告",-1)])]),_:1}),e(V,{label:"article"},{default:l(()=>[...t[25]||(t[25]=[d("文章",-1)])]),_:1}),e(V,{label:"news"},{default:l(()=>[...t[26]||(t[26]=[d("动态",-1)])]),_:1})]),_:1},8,["modelValue","onChange"])]),e(m,{type:"primary",onClick:n.openCreateContentDialog},{default:l(()=>[e(s,null,{default:l(()=>[e(q)]),_:1}),t[27]||(t[27]=d(" 发布内容 ",-1))]),_:1},8,["onClick"])])]),default:l(()=>[a("div",Pe,[e(_,{inline:!0,model:n.searchForm,"label-width":"80px"},{default:l(()=>[e(u,{label:"标题"},{default:l(()=>[e(C,{modelValue:n.searchForm.title,"onUpdate:modelValue":t[1]||(t[1]=o=>n.searchForm.title=o),placeholder:"请输入内容标题",clearable:""},null,8,["modelValue"])]),_:1}),e(u,{label:"状态"},{default:l(()=>[e(U,{modelValue:n.searchForm.status,"onUpdate:modelValue":t[2]||(t[2]=o=>n.searchForm.status=o),placeholder:"请选择状态",clearable:""},{default:l(()=>[e(c,{label:"全部",value:""}),e(c,{label:"已发布",value:"1"}),e(c,{label:"草稿",value:"0"})]),_:1},8,["modelValue"])]),_:1}),e(u,null,{default:l(()=>[e(m,{type:"primary",onClick:n.searchContents},{default:l(()=>[e(s,null,{default:l(()=>[e(A)]),_:1}),t[28]||(t[28]=d(" 查询 ",-1))]),_:1},8,["onClick"]),e(m,{onClick:n.resetSearch},{default:l(()=>[...t[29]||(t[29]=[d("重置",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"])]),e(G,{data:n.contents,style:{width:"100%"},class:"content-table"},{default:l(()=>[e(v,{prop:"id",label:"ID",width:"80"}),e(v,{prop:"title",label:"标题","min-width":"250"},{default:l(o=>[a("div",Ie,[a("span",qe,p(o.row.title),1),o.row.isTop?(k(),L(D,{key:0,size:"small",type:"danger"},{default:l(()=>[...t[30]||(t[30]=[d("置顶",-1)])]),_:1})):R("",!0)])]),_:1}),e(v,{prop:"contentType",label:"类型",width:"100"},{default:l(o=>[e(D,{type:n.getContentTypeTagType(o.row.contentType),effect:"light"},{default:l(()=>[d(p(n.getContentTypeText(o.row.contentType)),1)]),_:2},1032,["type"])]),_:1}),e(v,{prop:"author",label:"作者",width:"100"}),e(v,{prop:"status",label:"状态",width:"90"},{default:l(o=>[e(D,{type:n.getStatusTagType(o.row.status),effect:"plain"},{default:l(()=>[d(p(n.getStatusText(o.row.status)),1)]),_:2},1032,["type"])]),_:1}),e(v,{prop:"viewCount",label:"浏览",width:"80"},{default:l(o=>[a("span",Ee,p(o.row.viewCount),1)]),_:1}),e(v,{prop:"createTime",label:"发布时间",width:"160"}),e(v,{label:"操作",width:"220",fixed:"right"},{default:l(o=>[e(m,{type:"primary",link:"",onClick:N=>n.viewContentDetails(o.row)},{default:l(()=>[...t[31]||(t[31]=[d("查看",-1)])]),_:1},8,["onClick"]),e(m,{type:"warning",link:"",onClick:N=>n.editContent(o.row)},{default:l(()=>[...t[32]||(t[32]=[d("编辑",-1)])]),_:1},8,["onClick"]),o.row.status===1?(k(),L(m,{key:0,type:"danger",link:"",onClick:N=>n.unpublishContent(o.row)},{default:l(()=>[...t[33]||(t[33]=[d("下架",-1)])]),_:1},8,["onClick"])):(k(),L(m,{key:1,type:"success",link:"",onClick:N=>n.publishContent(o.row)},{default:l(()=>[...t[34]||(t[34]=[d("发布",-1)])]),_:1},8,["onClick"])),e(m,{type:"danger",link:"",onClick:N=>n.deleteContent(o.row)},{default:l(()=>[...t[35]||(t[35]=[d("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),a("div",Le,[e(K,{onSizeChange:n.handleSizeChange,onCurrentChange:n.handleCurrentChange,"current-page":n.currentPage,"page-sizes":[10,20,50,100],"page-size":n.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:n.totalContents},null,8,["onSizeChange","onCurrentChange","current-page","page-size","total"])])]),_:1}),e(M,{modelValue:n.createContentDialogVisible,"onUpdate:modelValue":t[15]||(t[15]=o=>n.createContentDialogVisible=o),title:n.isEditing?"编辑内容":"发布内容",width:"800px",class:"content-dialog"},{footer:l(()=>[a("span",Re,[e(m,{onClick:t[14]||(t[14]=o=>n.createContentDialogVisible=!1)},{default:l(()=>[...t[39]||(t[39]=[d("取消",-1)])]),_:1}),n.isEditing?R("",!0):(k(),L(m,{key:0,type:"info",onClick:n.saveDraft},{default:l(()=>[...t[40]||(t[40]=[d("保存草稿",-1)])]),_:1},8,["onClick"])),e(m,{type:"primary",onClick:n.createContent},{default:l(()=>[d(p(n.isEditing?"保存修改":"立即发布"),1)]),_:1},8,["onClick"])])]),default:l(()=>[e(_,{ref:"contentFormRef",model:n.contentForm,rules:n.contentRules,"label-width":"100px"},{default:l(()=>[e(z,{gutter:20},{default:l(()=>[e(w,{span:16},{default:l(()=>[e(u,{label:"标题",prop:"title"},{default:l(()=>[e(C,{modelValue:n.contentForm.title,"onUpdate:modelValue":t[3]||(t[3]=o=>n.contentForm.title=o),placeholder:"请输入内容标题",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1}),e(w,{span:8},{default:l(()=>[e(u,{label:"内容类型",prop:"contentType"},{default:l(()=>[e(U,{modelValue:n.contentForm.contentType,"onUpdate:modelValue":t[4]||(t[4]=o=>n.contentForm.contentType=o),placeholder:"请选择",style:{width:"100%"}},{default:l(()=>[e(c,{label:"系统公告",value:"notice"},{default:l(()=>[e(s,null,{default:l(()=>[e(T)]),_:1}),t[36]||(t[36]=d(" 系统公告 ",-1))]),_:1}),e(c,{label:"文章资讯",value:"article"},{default:l(()=>[e(s,null,{default:l(()=>[e(S)]),_:1}),t[37]||(t[37]=d(" 文章资讯 ",-1))]),_:1}),e(c,{label:"行业动态",value:"news"},{default:l(()=>[e(s,null,{default:l(()=>[e(g)]),_:1}),t[38]||(t[38]=d(" 行业动态 ",-1))]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(z,{gutter:20},{default:l(()=>[e(w,{span:8},{default:l(()=>[e(u,{label:"作者",prop:"author"},{default:l(()=>[e(C,{modelValue:n.contentForm.author,"onUpdate:modelValue":t[5]||(t[5]=o=>n.contentForm.author=o),placeholder:"请输入作者"},null,8,["modelValue"])]),_:1})]),_:1}),e(w,{span:8},{default:l(()=>[e(u,{label:"状态",prop:"status"},{default:l(()=>[e(U,{modelValue:n.contentForm.status,"onUpdate:modelValue":t[6]||(t[6]=o=>n.contentForm.status=o),placeholder:"请选择",style:{width:"100%"}},{default:l(()=>[e(c,{label:"立即发布",value:"1"}),e(c,{label:"保存草稿",value:"0"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(w,{span:8},{default:l(()=>[e(u,{label:"置顶"},{default:l(()=>[e(Q,{modelValue:n.contentForm.isTop,"onUpdate:modelValue":t[7]||(t[7]=o=>n.contentForm.isTop=o),"active-text":"是","inactive-text":"否"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(u,{label:"内容摘要",prop:"summary"},{default:l(()=>[e(C,{modelValue:n.contentForm.summary,"onUpdate:modelValue":t[8]||(t[8]=o=>n.contentForm.summary=o),type:"textarea",rows:3,placeholder:"请输入内容摘要（将显示在列表中）",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1}),n.contentForm.contentType==="news"?(k(),X(pe,{key:0},[e(z,{gutter:20},{default:l(()=>[e(w,{span:12},{default:l(()=>[e(u,{label:"来源名称"},{default:l(()=>[e(C,{modelValue:n.contentForm.sourceName,"onUpdate:modelValue":t[9]||(t[9]=o=>n.contentForm.sourceName=o),placeholder:"如：中国服装协会"},{prefix:l(()=>[e(s,null,{default:l(()=>[e(S)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(w,{span:12},{default:l(()=>[e(u,{label:"来源链接"},{default:l(()=>[e(C,{modelValue:n.contentForm.sourceUrl,"onUpdate:modelValue":t[10]||(t[10]=o=>n.contentForm.sourceUrl=o),placeholder:"原文链接地址"},{prefix:l(()=>[e(s,null,{default:l(()=>[e(J)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(u,{label:"封面图片"},{default:l(()=>[e(C,{modelValue:n.contentForm.coverImage,"onUpdate:modelValue":t[11]||(t[11]=o=>n.contentForm.coverImage=o),placeholder:"封面图片URL"},{prefix:l(()=>[e(s,null,{default:l(()=>[e(W)]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(u,{label:"标签"},{default:l(()=>[e(U,{modelValue:n.contentForm.tags,"onUpdate:modelValue":t[12]||(t[12]=o=>n.contentForm.tags=o),multiple:"",filterable:"","allow-create":"","default-first-option":"",placeholder:"选择或输入标签",style:{width:"100%"}},{default:l(()=>[e(c,{label:"行业趋势",value:"行业趋势"}),e(c,{label:"政策法规",value:"政策法规"}),e(c,{label:"技术创新",value:"技术创新"}),e(c,{label:"市场分析",value:"市场分析"}),e(c,{label:"企业动态",value:"企业动态"}),e(c,{label:"展会活动",value:"展会活动"})]),_:1},8,["modelValue"])]),_:1})],64)):R("",!0),e(u,{label:"内容详情",prop:"content"},{default:l(()=>[e(C,{modelValue:n.contentForm.content,"onUpdate:modelValue":t[13]||(t[13]=o=>n.contentForm.content=o),type:"textarea",rows:12,placeholder:"请输入内容详情（支持富文本格式）"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),e(M,{modelValue:n.detailDialogVisible,"onUpdate:modelValue":t[18]||(t[18]=o=>n.detailDialogVisible=o),title:n.selectedContent.title,width:"700px",class:"detail-dialog"},{footer:l(()=>[a("span",We,[e(m,{onClick:t[16]||(t[16]=o=>n.detailDialogVisible=!1)},{default:l(()=>[...t[43]||(t[43]=[d("关闭",-1)])]),_:1}),e(m,{type:"primary",onClick:t[17]||(t[17]=o=>n.editContent(n.selectedContent))},{default:l(()=>[...t[44]||(t[44]=[d("编辑",-1)])]),_:1})])]),default:l(()=>[n.selectedContent?(k(),X("div",je,[a("div",He,[e(D,{type:n.getContentTypeTagType(n.selectedContent.contentType)},{default:l(()=>[d(p(n.getContentTypeText(n.selectedContent.contentType)),1)]),_:1},8,["type"]),a("span",Ae,[e(s,null,{default:l(()=>[e(Z)]),_:1}),d(" "+p(n.selectedContent.author),1)]),a("span",Ge,[e(s,null,{default:l(()=>[e($)]),_:1}),d(" "+p(n.selectedContent.createTime),1)]),a("span",Ke,[e(s,null,{default:l(()=>[e(F)]),_:1}),d(" "+p(n.selectedContent.viewCount)+" 次浏览 ",1)])]),a("div",Oe,[t[41]||(t[41]=a("h4",null,"摘要",-1)),a("p",null,p(n.selectedContent.summary),1)]),a("div",Qe,[t[42]||(t[42]=a("h4",null,"正文",-1)),a("div",{class:"content-body",innerHTML:n.selectedContent.content},null,8,Je)])])):R("",!0)]),_:1},8,["modelValue","title"])])}const nt=te(_e,[["render",Xe],["__scopeId","data-v-043551d2"]]);export{nt as default};
