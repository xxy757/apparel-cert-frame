import{_ as P,a6 as j,r as x,K as A,B,h as F,o as J,j as n,k as y,n as w,q as i,t as e,w as o,D as u,y as b,G as D,F as R,v as z,I as L,U as E}from"./index-3d929bd0.js";import{r as O}from"./request-9595d616.js";import{e as S}from"./eventBus-7f99bbc0.js";const M={name:"PersonalProfile",components:{Edit:j},setup(){const g=x(null),l=x(!1),s=A({id:null,username:"",name:"",phone:"",email:"",idCard:"",careerDirection:"",avatar:""}),a=A({}),k={name:[{required:!0,message:"请输入姓名",trigger:"blur"},{min:2,max:10,message:"姓名长度应在2-10个字符之间",trigger:"blur"}],phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号码",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}],idCard:[{pattern:/(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/,message:"请输入正确的身份证号码",trigger:"blur"}],avatar:[{validator:(t,r,p)=>{if(!r){p();return}/^https?:\/\/.*\.(jpg|jpeg|png|gif|bmp|webp|svg|svg\?seed=.*)$/i.test(r)?p():p(new Error("请输入有效的图片URL地址"))},trigger:"blur"}]},U=`${{}.VITE_APP_API_BASE_URL||"/api"}/upload/avatar`,h={Authorization:`Bearer ${B("/personal")}`},_=F(()=>JSON.stringify(s)!==JSON.stringify(a)),C=async()=>{try{const t=await O.get("/auth/current-user");if(t.code===200){const r=t.data;Object.assign(s,{id:r.userId,username:r.username||"",name:r.name||"",phone:r.phone||"",email:r.email||"",idCard:r.idCard||"",careerDirection:r.careerDirection||"",avatar:r.avatar||""}),Object.assign(a,JSON.parse(JSON.stringify(s)))}else u.error(t.message||"获取用户信息失败")}catch(t){console.error("获取用户信息失败:",t),u.error("获取用户信息失败")}},v=(t,r,p)=>{t.code===200&&t.data&&t.data.url?(s.avatar=t.data.url,u.success("头像上传成功"),S.emit("user-updated"),g.value&&g.value.validateField("avatar")):u.error(t.message||"头像上传失败")},d=t=>{const r=t.type.indexOf("image/")===0,p=t.size/1024/1024<5;return r?p?!0:(u.error("图片大小不能超过 5MB!"),!1):(u.error("只能上传图片文件!"),!1)},c=async()=>{if(g.value){await g.value.validate(t=>{if(!t)return u.error("请填写完整并正确的信息"),!1}),l.value=!0;try{const t=await O.post("/user-personal/update-basic-info",{id:s.id,name:s.name,phone:s.phone,email:s.email,idCard:s.idCard,careerDirection:s.careerDirection,avatar:s.avatar});t.code===200?(u.success("个人信息更新成功"),Object.assign(a,JSON.parse(JSON.stringify(s))),S.emit("user-updated")):u.error(t.message||"更新失败")}catch(t){console.error("更新个人信息失败:",t),u.error("更新失败，请稍后重试")}finally{l.value=!1}}},f=["https://api.dicebear.com/7.x/adventurer/svg?seed=default1&backgroundColor=b6e3f4","https://api.dicebear.com/7.x/adventurer/svg?seed=default2&backgroundColor=c0aede","https://api.dicebear.com/7.x/adventurer/svg?seed=default3&backgroundColor=d1d4f9","https://api.dicebear.com/7.x/adventurer/svg?seed=default4&backgroundColor=ffd5dc","https://api.dicebear.com/7.x/adventurer/svg?seed=default5&backgroundColor=ffdfbf","https://api.dicebear.com/7.x/adventurer/svg?seed=default6&backgroundColor=b6e3f4,c0aede","https://api.dicebear.com/7.x/adventurer/svg?seed=default7&backgroundColor=d1d4f9,ffd5dc","https://api.dicebear.com/7.x/adventurer/svg?seed=default8&backgroundColor=ffdfbf,b6e3f4"],m=t=>{s.avatar=f[t]},I=()=>{const t=Math.floor(Math.random()*f.length);s.avatar=f[t]},V=()=>{Object.assign(s,JSON.parse(JSON.stringify(a)))};return J(()=>{C()}),{formRef:g,userInfo:s,rules:k,submitting:l,hasChanges:_,uploadUrl:U,uploadHeaders:h,handleAvatarSuccess:v,beforeAvatarUpload:d,submitForm:c,resetForm:V,defaultAvatars:f,selectDefaultAvatar:m,selectRandomDefaultAvatar:I}}},q={class:"profile-container"},T={class:"profile-form"},H={class:"avatar-section"},G={class:"avatar-preview"},K={class:"avatar-actions"},X={class:"default-avatars"},Q={class:"avatar-options"};function W(g,l,s,a,k,U){const h=n("el-avatar"),_=n("el-button"),C=n("el-upload"),v=n("el-input"),d=n("el-form-item"),c=n("el-col"),f=n("el-row"),m=n("el-option"),I=n("el-select"),V=n("el-form"),t=n("el-card");return y(),w("div",q,[l[12]||(l[12]=i("div",{class:"profile-header"},[i("h2",null,"个人信息")],-1)),i("div",T,[e(t,{class:"profile-card"},{default:o(()=>[i("div",H,[i("div",G,[e(h,{size:100,src:a.userInfo.avatar},{default:o(()=>[b(D(a.userInfo.name?a.userInfo.name.charAt(0):"U"),1)]),_:1},8,["src"]),i("div",K,[e(C,{class:"avatar-uploader",action:a.uploadUrl,"show-file-list":!1,headers:a.uploadHeaders,"on-success":a.handleAvatarSuccess,"before-upload":a.beforeAvatarUpload,accept:".jpg,.jpeg,.png,.gif","auto-upload":!0},{default:o(()=>[e(_,{type:"primary",size:"small"},{default:o(()=>[...l[7]||(l[7]=[b("上传头像",-1)])]),_:1})]),_:1},8,["action","headers","on-success","before-upload"]),e(_,{class:"avatar-random-btn",size:"small",onClick:a.selectRandomDefaultAvatar},{default:o(()=>[...l[8]||(l[8]=[b("随机头像",-1)])]),_:1},8,["onClick"])])]),i("div",X,[l[9]||(l[9]=i("h4",null,"选择默认头像:",-1)),i("div",Q,[(y(!0),w(R,null,z(a.defaultAvatars,(r,p)=>(y(),L(h,{key:p,size:60,src:r,class:E(["default-avatar-option",{selected:a.userInfo.avatar===r}]),onClick:N=>a.selectDefaultAvatar(p)},null,8,["src","class","onClick"]))),128))])]),l[10]||(l[10]=i("p",{class:"avatar-tip"},"点击上方头像预览当前头像，使用上面的按钮上传新头像，或从默认头像中选择一个。",-1))]),e(V,{model:a.userInfo,rules:a.rules,ref:"formRef","label-width":"120px",class:"profile-form-content"},{default:o(()=>[e(f,{gutter:20},{default:o(()=>[e(c,{span:12},{default:o(()=>[e(d,{label:"用户名",prop:"username"},{default:o(()=>[e(v,{modelValue:a.userInfo.username,"onUpdate:modelValue":l[0]||(l[0]=r=>a.userInfo.username=r),disabled:""},null,8,["modelValue"])]),_:1})]),_:1}),e(c,{span:12},{default:o(()=>[e(d,{label:"姓名",prop:"name"},{default:o(()=>[e(v,{modelValue:a.userInfo.name,"onUpdate:modelValue":l[1]||(l[1]=r=>a.userInfo.name=r),placeholder:"请输入姓名"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(f,{gutter:20},{default:o(()=>[e(c,{span:12},{default:o(()=>[e(d,{label:"手机号",prop:"phone"},{default:o(()=>[e(v,{modelValue:a.userInfo.phone,"onUpdate:modelValue":l[2]||(l[2]=r=>a.userInfo.phone=r),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1})]),_:1}),e(c,{span:12},{default:o(()=>[e(d,{label:"邮箱",prop:"email"},{default:o(()=>[e(v,{modelValue:a.userInfo.email,"onUpdate:modelValue":l[3]||(l[3]=r=>a.userInfo.email=r),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(f,{gutter:20},{default:o(()=>[e(c,{span:12},{default:o(()=>[e(d,{label:"身份证号",prop:"idCard"},{default:o(()=>[e(v,{modelValue:a.userInfo.idCard,"onUpdate:modelValue":l[4]||(l[4]=r=>a.userInfo.idCard=r),placeholder:"请输入身份证号"},null,8,["modelValue"])]),_:1})]),_:1}),e(c,{span:12},{default:o(()=>[e(d,{label:"职业方向",prop:"careerDirection"},{default:o(()=>[e(I,{modelValue:a.userInfo.careerDirection,"onUpdate:modelValue":l[5]||(l[5]=r=>a.userInfo.careerDirection=r),placeholder:"请选择职业方向",style:{width:"100%"}},{default:o(()=>[e(m,{label:"服装设计师",value:"服装设计师"}),e(m,{label:"版型师",value:"版型师"}),e(m,{label:"工艺师",value:"工艺师"}),e(m,{label:"面料工程师",value:"面料工程师"}),e(m,{label:"质量控制",value:"质量控制"}),e(m,{label:"生产管理",value:"生产管理"}),e(m,{label:"其他",value:"其他"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(f,{gutter:20},{default:o(()=>[e(c,{span:24},{default:o(()=>[e(d,{label:"头像URL"},{default:o(()=>[e(v,{modelValue:a.userInfo.avatar,"onUpdate:modelValue":l[6]||(l[6]=r=>a.userInfo.avatar=r),placeholder:"可输入自定义头像URL地址",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(d,null,{default:o(()=>[e(_,{type:"primary",onClick:a.submitForm,loading:a.submitting,disabled:!a.hasChanges},{default:o(()=>[b(D(a.submitting?"保存中...":"保存信息"),1)]),_:1},8,["onClick","loading","disabled"]),e(_,{onClick:a.resetForm},{default:o(()=>[...l[11]||(l[11]=[b("重置",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model","rules"])]),_:1})])])}const ee=P(M,[["render",W],["__scopeId","data-v-cfc2f744"]]);export{ee as default};
