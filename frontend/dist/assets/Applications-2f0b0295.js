import{_ as le,K as se,r as v,h as oe,o as ne,j as c,k as p,n as E,q as l,F as L,v as x,t as o,w as i,I as C,Q as W,d as ie,ak as re,aq as ce,ar as ue,a5 as H,D as h,H as de,J as pe,G as n,R as me,y as g,V as J,W as _e,E as U}from"./index-3d929bd0.js";import{r as z}from"./request-9595d616.js";const ve={class:"applications-container"},ge={class:"stats-cards"},ye={class:"stat-info"},fe={class:"stat-value"},Ie={class:"stat-label"},Ee={class:"filter-bar"},be={class:"applications-list"},he=["onClick"],we={class:"company-logo"},Te=["src"],Ne={class:"application-info"},De={class:"job-title"},ke={class:"company-name"},Ce={class:"job-meta"},Ve={class:"salary"},je={class:"location"},Pe={class:"apply-time"},Le={class:"application-status"},xe={class:"status-time"},We={class:"application-actions"},ze={class:"pagination-wrapper"},Re={key:0,class:"detail-content"},Se={class:"detail-header"},Ae=["src"],Be={class:"detail-info"},Q="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjY0IiBoZWlnaHQ9IjY0IiBmaWxsPSIjZjBmMGYwIi8+PHRleHQgeD0iMzIiIHk9IjM4IiBmb250LXNpemU9IjI0IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSIjY2NjIj7kvIE8L3RleHQ+PC9zdmc+",$e={__name:"Applications",setup(Ge){const m=se([{key:"total",label:"总申请",value:0,icon:ie,color:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"},{key:"viewed",label:"已查看",value:0,icon:re,color:"linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)"},{key:"interview",label:"面试中",value:0,icon:ce,color:"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)"},{key:"accepted",label:"已通过",value:0,icon:ue,color:"linear-gradient(135deg, #11998e 0%, #38ef7d 100%)"}]),w=v(""),T=v(""),R=v([]),S=v(1),A=v(10),V=v(0),y=v([]),j=v(!1),u=v(null),B=oe(()=>{let a=y.value;if(w.value){const e=w.value.toLowerCase();a=a.filter(d=>d.jobTitle.toLowerCase().includes(e)||d.companyName.toLowerCase().includes(e))}return T.value&&(a=a.filter(e=>e.status===T.value)),a}),$=a=>({PENDING:"info",VIEWED:"warning",INTERVIEW:"primary",ACCEPTED:"success",REJECTED:"danger"})[a]||"info",G=a=>({PENDING:"待处理",VIEWED:"已查看",INTERVIEW:"面试中",ACCEPTED:"已通过",REJECTED:"已拒绝"})[a]||a,M=a=>a?new Date(a).toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"}):"",Z=a=>{u.value=a,j.value=!0},Y=a=>({0:"待确认",1:"已确认",2:"已完成",3:"已取消"})[a]||"未知",F=a=>{if(!a)return"-";const e=new Date(String(a).replace(" ","T"));return Number.isNaN(e.getTime())?"-":e.toLocaleString("zh-CN",{hour12:!1})},q=async a=>{var e,d;try{const f=Number(H("/personal")||0);if(!f){h.warning("请先登录");return}const s=await z.get("/interview/user",{params:{userId:f,page:1,size:100}}),r=(((e=s.data)==null?void 0:e.records)||((d=s.data)==null?void 0:d.list)||[]).filter(I=>String(I.deliveryId||"")===String(a.id||"")||String(I.jobId||"")===String(a.jobId||"")).sort((I,P)=>new Date(P.interviewTime||0)-new Date(I.interviewTime||0));if(r.length===0){h.info("该申请暂无面试记录");return}const _=r[0],N=[`面试ID：${_.id||"-"}`,`职位：${a.jobTitle||"-"}`,`时间：${F(_.interviewTime)}`,`地点：${_.interviewLocation||"-"}`,`形式：${_.interviewType||"-"}`,`面试官：${_.interviewer||"-"}`,`状态：${Y(_.status)}`,`备注：${_.remark||"-"}`].join(`
`);U.alert(N,"面试详情",{confirmButtonText:"确定"})}catch(f){console.error("获取面试详情失败:",f),h.error("获取面试详情失败，请稍后重试")}},K=a=>{U.confirm("确定要撤回该申请吗？撤回后无法恢复","撤回确认",{confirmButtonText:"确定撤回",cancelButtonText:"取消",type:"warning"}).then(async()=>{h.info("当前系统暂不支持撤回申请")}).catch(()=>{})},X=async()=>{try{const a=await z.get("/personal/job/applications",{params:{userId:Number(H("/personal")||0)}}),e={0:"PENDING",1:"VIEWED",2:"INTERVIEW",3:"REJECTED",4:"ACCEPTED"},d=a.data||[],f=await Promise.all(d.map(s=>z.get("/personal/job/detail",{params:{jobId:s.jobId}}).then(b=>b.data).catch(()=>null)));y.value=d.map((s,b)=>{const r=f[b];return{id:s.id,jobId:s.jobId,jobTitle:(r==null?void 0:r.title)||`岗位 ${s.jobId}`,companyName:s.enterpriseId?`企业ID ${s.enterpriseId}`:"-",companyLogo:null,salary:(r==null?void 0:r.salary)||"-",location:(r==null?void 0:r.location)||"-",applyTime:s.applyTime,status:e[s.status]||"PENDING",statusTime:s.feedbackTime,timeline:[]}}),V.value=y.value.length,m[0].value=y.value.length,m[1].value=y.value.filter(s=>s.status==="VIEWED").length,m[2].value=y.value.filter(s=>s.status==="INTERVIEW").length,m[3].value=y.value.filter(s=>s.status==="ACCEPTED").length}catch(a){console.error("加载申请记录失败:",a),y.value=[],V.value=0,m[0].value=0,m[1].value=0,m[2].value=0,m[3].value=0,h.error("加载申请记录失败，请稍后重试")}};return ne(()=>{X()}),(a,e)=>{const d=c("el-icon"),f=c("el-input"),s=c("el-option"),b=c("el-select"),r=c("el-date-picker"),_=c("el-empty"),N=c("el-tag"),I=c("el-button"),P=c("el-pagination"),D=c("el-descriptions-item"),O=c("el-descriptions"),ee=c("el-timeline-item"),te=c("el-timeline"),ae=c("el-drawer");return p(),E("div",ve,[e[9]||(e[9]=l("div",{class:"page-header"},[l("h1",null,"我的求职申请"),l("p",{class:"subtitle"},"追踪您的求职进度，管理面试安排")],-1)),l("div",ge,[(p(!0),E(L,null,x(m,t=>(p(),E("div",{class:"stat-card",key:t.key},[l("div",{class:"stat-icon",style:de({background:t.color})},[o(d,null,{default:i(()=>[(p(),C(pe(t.icon)))]),_:2},1024)],4),l("div",ye,[l("span",fe,n(t.value),1),l("span",Ie,n(t.label),1)])]))),128))]),l("div",Ee,[o(f,{modelValue:w.value,"onUpdate:modelValue":e[0]||(e[0]=t=>w.value=t),placeholder:"搜索职位名称或公司名","prefix-icon":"Search",clearable:"",class:"search-input"},null,8,["modelValue"]),o(b,{modelValue:T.value,"onUpdate:modelValue":e[1]||(e[1]=t=>T.value=t),placeholder:"申请状态",clearable:"",class:"status-select"},{default:i(()=>[o(s,{label:"全部状态",value:""}),o(s,{label:"待处理",value:"PENDING"}),o(s,{label:"已查看",value:"VIEWED"}),o(s,{label:"面试中",value:"INTERVIEW"}),o(s,{label:"已通过",value:"ACCEPTED"}),o(s,{label:"已拒绝",value:"REJECTED"})]),_:1},8,["modelValue"]),o(r,{modelValue:R.value,"onUpdate:modelValue":e[2]||(e[2]=t=>R.value=t),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",class:"date-picker"},null,8,["modelValue"])]),l("div",be,[B.value.length===0?(p(),C(_,{key:0,description:"暂无求职申请记录"})):W("",!0),(p(!0),E(L,null,x(B.value,t=>(p(),E("div",{class:"application-card",key:t.id,onClick:k=>Z(t)},[l("div",we,[l("img",{src:t.companyLogo||Q,alt:"公司Logo"},null,8,Te)]),l("div",Ne,[l("h3",De,n(t.jobTitle),1),l("p",ke,[o(d,null,{default:i(()=>[o(me(_e))]),_:1}),g(" "+n(t.companyName),1)]),l("div",Ce,[l("span",Ve,n(t.salary),1),l("span",je,n(t.location),1),l("span",Pe,"投递于 "+n(M(t.applyTime)),1)])]),l("div",Le,[o(N,{type:$(t.status),size:"large"},{default:i(()=>[g(n(G(t.status)),1)]),_:2},1032,["type"]),l("p",xe,n(t.statusTime),1)]),l("div",We,[t.status==="INTERVIEW"?(p(),C(I,{key:0,type:"primary",size:"small",onClick:J(k=>q(t),["stop"])},{default:i(()=>[...e[6]||(e[6]=[g(" 查看面试 ",-1)])]),_:1},8,["onClick"])):W("",!0),o(I,{type:"info",size:"small",plain:"",onClick:J(k=>K(),["stop"]),disabled:["ACCEPTED","REJECTED"].includes(t.status)},{default:i(()=>[...e[7]||(e[7]=[g(" 撤回申请 ",-1)])]),_:1},8,["onClick","disabled"])])],8,he))),128))]),l("div",ze,[o(P,{"current-page":S.value,"onUpdate:currentPage":e[3]||(e[3]=t=>S.value=t),"page-size":A.value,"onUpdate:pageSize":e[4]||(e[4]=t=>A.value=t),total:V.value,"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next, jumper",background:""},null,8,["current-page","page-size","total"])]),o(ae,{modelValue:j.value,"onUpdate:modelValue":e[5]||(e[5]=t=>j.value=t),title:"申请详情",size:"500px"},{default:i(()=>[u.value?(p(),E("div",Re,[l("div",Se,[l("img",{src:u.value.companyLogo||Q,class:"detail-logo"},null,8,Ae),l("div",Be,[l("h2",null,n(u.value.jobTitle),1),l("p",null,n(u.value.companyName),1)])]),o(O,{column:1,border:"",class:"detail-descriptions"},{default:i(()=>[o(D,{label:"薪资待遇"},{default:i(()=>[g(n(u.value.salary),1)]),_:1}),o(D,{label:"工作地点"},{default:i(()=>[g(n(u.value.location),1)]),_:1}),o(D,{label:"投递时间"},{default:i(()=>[g(n(M(u.value.applyTime)),1)]),_:1}),o(D,{label:"当前状态"},{default:i(()=>[o(N,{type:$(u.value.status)},{default:i(()=>[g(n(G(u.value.status)),1)]),_:1},8,["type"])]),_:1})]),_:1}),e[8]||(e[8]=l("h3",{class:"timeline-title"},"申请进度",-1)),o(te,null,{default:i(()=>[(p(!0),E(L,null,x(u.value.timeline,(t,k)=>(p(),C(ee,{key:k,type:t.type,timestamp:t.time,placement:"top"},{default:i(()=>[g(n(t.content),1)]),_:2},1032,["type","timestamp"]))),128))]),_:1})])):W("",!0)]),_:1},8,["modelValue"])])}}},Je=le($e,[["__scopeId","data-v-b8762177"]]);export{Je as default};
