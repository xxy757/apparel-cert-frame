import{_ as ve,g as ge,r as n,K as S,h as q,o as _e,j as m,k as f,n as v,q as t,t as s,w as l,Q as U,F as we,S as N,T as B,G as z,R as d,U as X,H as J,y as _,D as w,$ as ye,u as he,X as x,a as Y,Z as ee,a0 as be}from"./index-3d929bd0.js";import{r as D}from"./request-9595d616.js";function ke(Z,T){return D({url:"/auth/dev-reset-password",method:"post",data:{account:Z,newPassword:T}})}const Ve={class:"forgot-container"},ze={class:"forgot-card"},Pe={class:"forgot-header"},xe={class:"logo"},Fe={key:0},Re={key:1},Ce={key:0,class:"mode-switch"},Se={key:1,class:"step-content"},qe={class:"password-strength"},Ue={class:"strength-bar"},De={class:"strength-text"},Te={class:"step-content"},$e={class:"step-content"},Ee={class:"verify-info"},Me={class:"email-display"},Ie={class:"code-input-group"},Ne={class:"step-content"},Be={class:"password-strength"},Ze={class:"strength-bar"},je={class:"strength-text"},Ae={key:3,class:"step-content success-content"},Ge={class:"success-icon"},He={key:4,class:"step-content success-content"},Ke={class:"success-icon"},Le={key:5,class:"forgot-footer"},Oe={__name:"ForgotPassword",setup(Z){const T=ge(),se=n(!0),p=n(!1),$=n(!1),c=n(0),F=n(!1),E=n(!1),y=n(0);let j=null;const A=n(null),G=n(null),H=n(null),K=n(null),u=S({account:"",password:"",confirmPassword:""}),h=S({email:""}),P=S({code:""}),g=S({password:"",confirmPassword:""}),b=n(!1),le=[{label:"邮件验证",value:!1},{label:"开发模式",value:!0}],R=q(()=>{const o=p.value?u.password:g.password;if(!o)return"";let e=0;return o.length>=6&&e++,o.length>=10&&e++,/[a-z]/.test(o)&&/[A-Z]/.test(o)&&e++,/\d/.test(o)&&e++,/[!@#$%^&*]/.test(o)&&e++,e<=2?"weak":e<=3?"medium":"strong"}),L=q(()=>({weak:"33%",medium:"66%",strong:"100%"})[R.value]||"0%"),O=q(()=>({weak:"弱",medium:"中",strong:"强"})[R.value]||""),te=q(()=>{const o=h.email;if(!o)return"";const[e,a]=o.split("@");return e.length<=2?o:`${e.slice(0,2)}***@${a}`}),oe={account:[{required:!0,message:"请输入账号",trigger:"blur"}],password:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码长度不能少于6位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认新密码",trigger:"blur"},{validator:(o,e,a)=>{e!==u.password?a(new Error("两次输入密码不一致")):a()},trigger:"blur"}]},ae={email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}]},re={code:[{required:!0,message:"请输入验证码",trigger:"blur"},{len:6,message:"验证码为6位数字",trigger:"blur"}]},ne={password:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码长度不能少于6位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认新密码",trigger:"blur"},{validator:(o,e,a)=>{e!==g.password?a(new Error("两次输入密码不一致")):a()},trigger:"blur"}]},de=async()=>{var o,e;try{await A.value.validate(),b.value=!0,await ke(u.account,u.password),w.success("密码重置成功"),$.value=!0}catch(a){if(a!==!1){const M=((e=(o=a==null?void 0:a.response)==null?void 0:o.data)==null?void 0:e.message)||(a==null?void 0:a.message)||"重置失败，请稍后重试";w.error(M)}}finally{b.value=!1}},ue=()=>{y.value=60,j=setInterval(()=>{y.value--,y.value<=0&&clearInterval(j)},1e3)},Q=async()=>{try{await G.value.validate(),F.value=!0,await D.post("/auth/forget-password",{email:h.email}),w.success("验证码已发送，请查收邮件"),c.value=1,ue()}catch(o){o!==!1&&w.error(o.message||"发送失败，请稍后重试")}finally{F.value=!1}},ie=()=>{y.value>0||Q()},pe=async()=>{try{await H.value.validate(),E.value=!0,await D.post("/auth/verify-reset-code",{email:h.email,code:P.code}),w.success("验证成功"),c.value=2}catch(o){o!==!1&&w.error("验证码错误，请重新输入")}finally{E.value=!1}},ce=async()=>{try{await K.value.validate(),b.value=!0,await D.post("/auth/reset-password",{email:h.email,code:P.code,newPassword:g.password}),w.success("密码重置成功"),c.value=3}catch(o){o!==!1&&w.error(o.message||"重置失败，请稍后重试")}finally{b.value=!1}},W=()=>{T.push("/login")};return _e(()=>{const o=localStorage.getItem("forgotPwdDevMode");o!==null&&(p.value=o==="true")}),(o,e)=>{const a=m("el-icon"),M=m("el-segmented"),k=m("el-input"),i=m("el-form-item"),V=m("el-button"),C=m("el-form"),I=m("el-step"),me=m("el-steps"),fe=m("router-link");return f(),v("div",Ve,[e[22]||(e[22]=t("div",{class:"forgot-bg"},[t("div",{class:"bg-shape shape-1"}),t("div",{class:"bg-shape shape-2"})],-1)),t("div",ze,[t("div",Pe,[t("div",xe,[s(a,{size:40},{default:l(()=>[s(d(ye))]),_:1})]),e[8]||(e[8]=t("h1",null,"找回密码",-1)),p.value?(f(),v("p",Fe,"开发模式 - 快速重置密码")):(f(),v("p",Re,"通过邮箱验证重置您的密码"))]),se.value?(f(),v("div",Ce,[s(M,{modelValue:p.value,"onUpdate:modelValue":e[0]||(e[0]=r=>p.value=r),options:le,size:"default"},{default:l(({item:r})=>[t("span",null,z(r.label),1)]),_:1},8,["modelValue"])])):U("",!0),p.value?(f(),v("div",Se,[s(C,{ref_key:"devFormRef",ref:A,model:u,rules:oe,"label-position":"top"},{default:l(()=>[s(i,{label:"账号",prop:"account"},{default:l(()=>[s(k,{modelValue:u.account,"onUpdate:modelValue":e[1]||(e[1]=r=>u.account=r),placeholder:"用户名 / 邮箱 / 手机号",size:"large"},{prefix:l(()=>[s(a,null,{default:l(()=>[s(d(he))]),_:1})]),_:1},8,["modelValue"]),e[9]||(e[9]=t("div",{class:"input-tip"},"输入用户名、邮箱或手机号均可",-1))]),_:1}),s(i,{label:"新密码",prop:"password"},{default:l(()=>[s(k,{modelValue:u.password,"onUpdate:modelValue":e[2]||(e[2]=r=>u.password=r),type:"password",placeholder:"请输入新密码（至少6位）",size:"large","show-password":""},{prefix:l(()=>[s(a,null,{default:l(()=>[s(d(x))]),_:1})]),_:1},8,["modelValue"]),t("div",qe,[e[10]||(e[10]=t("span",null,"密码强度：",-1)),t("div",Ue,[t("div",{class:X(["strength-level",R.value]),style:J({width:L.value})},null,6)]),t("span",De,z(O.value),1)])]),_:1}),s(i,{label:"确认新密码",prop:"confirmPassword"},{default:l(()=>[s(k,{modelValue:u.confirmPassword,"onUpdate:modelValue":e[3]||(e[3]=r=>u.confirmPassword=r),type:"password",placeholder:"请再次输入新密码",size:"large","show-password":""},{prefix:l(()=>[s(a,null,{default:l(()=>[s(d(x))]),_:1})]),_:1},8,["modelValue"])]),_:1}),s(i,null,{default:l(()=>[s(V,{type:"primary",size:"large",style:{width:"100%"},onClick:de,loading:b.value},{default:l(()=>[_(z(b.value?"重置中...":"重置密码"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])])):(f(),v(we,{key:2},[s(me,{active:c.value,"finish-status":"success",class:"forgot-steps"},{default:l(()=>[s(I,{title:"验证邮箱"}),s(I,{title:"输入验证码"}),s(I,{title:"重置密码"})]),_:1},8,["active"]),N(t("div",Te,[s(C,{ref_key:"emailFormRef",ref:G,model:h,rules:ae,"label-position":"top"},{default:l(()=>[s(i,{label:"注册邮箱",prop:"email"},{default:l(()=>[s(k,{modelValue:h.email,"onUpdate:modelValue":e[4]||(e[4]=r=>h.email=r),placeholder:"请输入您注册时使用的邮箱",size:"large"},{prefix:l(()=>[s(a,null,{default:l(()=>[s(d(Y))]),_:1})]),_:1},8,["modelValue"])]),_:1}),s(i,null,{default:l(()=>[s(V,{type:"primary",size:"large",style:{width:"100%"},onClick:Q,loading:F.value},{default:l(()=>[_(z(F.value?"发送中...":"发送验证码"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])],512),[[B,c.value===0]]),N(t("div",$e,[t("div",Ee,[s(a,{size:48,color:"#409eff"},{default:l(()=>[s(d(Y))]),_:1}),e[11]||(e[11]=t("p",null,"验证码已发送至",-1)),t("p",Me,z(te.value),1)]),s(C,{ref_key:"codeFormRef",ref:H,model:P,rules:re,"label-position":"top"},{default:l(()=>[s(i,{label:"验证码",prop:"code"},{default:l(()=>[t("div",Ie,[s(k,{modelValue:P.code,"onUpdate:modelValue":e[5]||(e[5]=r=>P.code=r),placeholder:"请输入6位验证码",size:"large",maxlength:"6"},{prefix:l(()=>[s(a,null,{default:l(()=>[s(d(x))]),_:1})]),_:1},8,["modelValue"]),s(V,{disabled:y.value>0,onClick:ie,size:"large"},{default:l(()=>[_(z(y.value>0?`${y.value}s后重发`:"重新发送"),1)]),_:1},8,["disabled"])])]),_:1}),s(i,null,{default:l(()=>[s(V,{type:"primary",size:"large",style:{width:"100%"},onClick:pe,loading:E.value},{default:l(()=>[...e[12]||(e[12]=[_(" 验证 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])],512),[[B,c.value===1]]),N(t("div",Ne,[s(C,{ref_key:"passwordFormRef",ref:K,model:g,rules:ne,"label-position":"top"},{default:l(()=>[s(i,{label:"新密码",prop:"password"},{default:l(()=>[s(k,{modelValue:g.password,"onUpdate:modelValue":e[6]||(e[6]=r=>g.password=r),type:"password",placeholder:"请输入新密码（至少6位）",size:"large","show-password":""},{prefix:l(()=>[s(a,null,{default:l(()=>[s(d(x))]),_:1})]),_:1},8,["modelValue"]),t("div",Be,[e[13]||(e[13]=t("span",null,"密码强度：",-1)),t("div",Ze,[t("div",{class:X(["strength-level",R.value]),style:J({width:L.value})},null,6)]),t("span",je,z(O.value),1)])]),_:1}),s(i,{label:"确认新密码",prop:"confirmPassword"},{default:l(()=>[s(k,{modelValue:g.confirmPassword,"onUpdate:modelValue":e[7]||(e[7]=r=>g.confirmPassword=r),type:"password",placeholder:"请再次输入新密码",size:"large","show-password":""},{prefix:l(()=>[s(a,null,{default:l(()=>[s(d(x))]),_:1})]),_:1},8,["modelValue"])]),_:1}),s(i,null,{default:l(()=>[s(V,{type:"primary",size:"large",style:{width:"100%"},onClick:ce,loading:b.value},{default:l(()=>[...e[14]||(e[14]=[_(" 重置密码 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])],512),[[B,c.value===2]])],64)),p.value&&$.value?(f(),v("div",Ae,[t("div",Ge,[s(a,{size:80,color:"#67c23a"},{default:l(()=>[s(d(ee))]),_:1})]),e[16]||(e[16]=t("h2",null,"密码重置成功！",-1)),e[17]||(e[17]=t("p",null,"您的密码已成功重置，请使用新密码登录",-1)),s(V,{type:"primary",size:"large",onClick:W},{default:l(()=>[...e[15]||(e[15]=[_(" 立即登录 ",-1)])]),_:1})])):U("",!0),!p.value&&c.value===3?(f(),v("div",He,[t("div",Ke,[s(a,{size:80,color:"#67c23a"},{default:l(()=>[s(d(ee))]),_:1})]),e[19]||(e[19]=t("h2",null,"密码重置成功！",-1)),e[20]||(e[20]=t("p",null,"您的密码已成功重置，请使用新密码登录",-1)),s(V,{type:"primary",size:"large",onClick:W},{default:l(()=>[...e[18]||(e[18]=[_(" 立即登录 ",-1)])]),_:1})])):U("",!0),!$.value&&(p.value||c.value<3)?(f(),v("div",Le,[s(fe,{to:"/login"},{default:l(()=>[s(a,null,{default:l(()=>[s(d(be))]),_:1}),e[21]||(e[21]=_(" 返回登录 ",-1))]),_:1})])):U("",!0)])])}}},Xe=ve(Oe,[["__scopeId","data-v-b850ee09"]]);export{Xe as default};
