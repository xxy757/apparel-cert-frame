import{_ as se,g as te,r as i,D as S,h as b,i as d,j as $,k as B,n as o,q as s,w as t,K as k,L as V,z,I as le,J as u,x as _,M as oe,A as ae,y as g,S as re,a as D,P as q,R as ne,T as ie}from"./index-94722956.js";import{r as A}from"./request-95526739.js";const de={class:"forgot-container"},ue={class:"forgot-card"},ce={class:"forgot-header"},pe={class:"logo"},me={class:"step-content"},fe={class:"step-content"},_e={class:"verify-info"},ge={class:"email-display"},ve={class:"code-input-group"},we={class:"step-content"},ye={class:"password-strength"},he={class:"strength-bar"},be={class:"strength-text"},ke={class:"step-content success-content"},Ve={class:"success-icon"},ze={key:0,class:"forgot-footer"},Ce={__name:"ForgotPassword",setup(xe){const L=te(),r=i(0),w=i(!1),C=i(!1),x=i(!1),c=i(0);let T=null;const E=i(null),I=i(null),N=i(null),f=S({email:""}),y=S({code:""}),n=S({password:"",confirmPassword:""}),M=b(()=>{const l=f.email;if(!l)return"";const[e,a]=l.split("@");return e.length<=2?l:`${e.slice(0,2)}***@${a}`}),P=b(()=>{const l=n.password;if(!l)return"";let e=0;return l.length>=6&&e++,l.length>=10&&e++,/[a-z]/.test(l)&&/[A-Z]/.test(l)&&e++,/\d/.test(l)&&e++,/[!@#$%^&*]/.test(l)&&e++,e<=2?"weak":e<=3?"medium":"strong"}),j=b(()=>({weak:"33%",medium:"66%",strong:"100%"})[P.value]||"0%"),J=b(()=>({weak:"弱",medium:"中",strong:"强"})[P.value]||""),K={email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}]},W={code:[{required:!0,message:"请输入验证码",trigger:"blur"},{len:6,message:"验证码为6位数字",trigger:"blur"}]},Z={password:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码长度不能少于6位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认新密码",trigger:"blur"},{validator:(l,e,a)=>{e!==n.password?a(new Error("两次输入密码不一致")):a()},trigger:"blur"}]},G=()=>{c.value=60,T=setInterval(()=>{c.value--,c.value<=0&&clearInterval(T)},1e3)},U=async()=>{try{await E.value.validate(),w.value=!0,await A.post("/auth/forgot-password",{email:f.email}),g.success("验证码已发送，请查收邮件"),r.value=1,G()}catch(l){l!==!1&&g.error(l.message||"发送失败，请稍后重试")}finally{w.value=!1}},H=()=>{c.value>0||U()},O=async()=>{try{await I.value.validate(),C.value=!0,await new Promise(l=>setTimeout(l,1e3)),g.success("验证成功"),r.value=2}catch(l){l!==!1&&g.error("验证码错误，请重新输入")}finally{C.value=!1}},Q=async()=>{try{await N.value.validate(),x.value=!0,await A.post("/auth/reset-password",{email:f.email,code:y.code,newPassword:n.password}),g.success("密码重置成功"),r.value=3}catch(l){l!==!1&&g.error(l.message||"重置失败，请稍后重试")}finally{x.value=!1}},X=()=>{L.push("/login")};return(l,e)=>{const a=d("el-icon"),F=d("el-step"),Y=d("el-steps"),h=d("el-input"),p=d("el-form-item"),v=d("el-button"),R=d("el-form"),ee=d("router-link");return $(),B("div",de,[e[14]||(e[14]=o("div",{class:"forgot-bg"},[o("div",{class:"bg-shape shape-1"}),o("div",{class:"bg-shape shape-2"})],-1)),o("div",ue,[o("div",ce,[o("div",pe,[s(a,{size:40},{default:t(()=>[s(u(re))]),_:1})]),e[4]||(e[4]=o("h1",null,"找回密码",-1)),e[5]||(e[5]=o("p",null,"通过邮箱验证重置您的密码",-1))]),s(Y,{active:r.value,"finish-status":"success",class:"forgot-steps"},{default:t(()=>[s(F,{title:"验证邮箱"}),s(F,{title:"输入验证码"}),s(F,{title:"重置密码"})]),_:1},8,["active"]),k(o("div",me,[s(R,{ref_key:"emailFormRef",ref:E,model:f,rules:K,"label-position":"top"},{default:t(()=>[s(p,{label:"注册邮箱",prop:"email"},{default:t(()=>[s(h,{modelValue:f.email,"onUpdate:modelValue":e[0]||(e[0]=m=>f.email=m),placeholder:"请输入您注册时使用的邮箱",size:"large"},{prefix:t(()=>[s(a,null,{default:t(()=>[s(u(D))]),_:1})]),_:1},8,["modelValue"])]),_:1}),s(p,null,{default:t(()=>[s(v,{type:"primary",size:"large",style:{width:"100%"},onClick:U,loading:w.value},{default:t(()=>[_(z(w.value?"发送中...":"发送验证码"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])],512),[[V,r.value===0]]),k(o("div",fe,[o("div",_e,[s(a,{size:48,color:"#409eff"},{default:t(()=>[s(u(D))]),_:1}),e[6]||(e[6]=o("p",null,"验证码已发送至",-1)),o("p",ge,z(M.value),1)]),s(R,{ref_key:"codeFormRef",ref:I,model:y,rules:W,"label-position":"top"},{default:t(()=>[s(p,{label:"验证码",prop:"code"},{default:t(()=>[o("div",ve,[s(h,{modelValue:y.code,"onUpdate:modelValue":e[1]||(e[1]=m=>y.code=m),placeholder:"请输入6位验证码",size:"large",maxlength:"6"},{prefix:t(()=>[s(a,null,{default:t(()=>[s(u(q))]),_:1})]),_:1},8,["modelValue"]),s(v,{disabled:c.value>0,onClick:H,size:"large"},{default:t(()=>[_(z(c.value>0?`${c.value}s后重发`:"重新发送"),1)]),_:1},8,["disabled"])])]),_:1}),s(p,null,{default:t(()=>[s(v,{type:"primary",size:"large",style:{width:"100%"},onClick:O,loading:C.value},{default:t(()=>[...e[7]||(e[7]=[_(" 验证 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])],512),[[V,r.value===1]]),k(o("div",we,[s(R,{ref_key:"passwordFormRef",ref:N,model:n,rules:Z,"label-position":"top"},{default:t(()=>[s(p,{label:"新密码",prop:"password"},{default:t(()=>[s(h,{modelValue:n.password,"onUpdate:modelValue":e[2]||(e[2]=m=>n.password=m),type:"password",placeholder:"请输入新密码（至少6位）",size:"large","show-password":""},{prefix:t(()=>[s(a,null,{default:t(()=>[s(u(q))]),_:1})]),_:1},8,["modelValue"]),o("div",ye,[e[8]||(e[8]=o("span",null,"密码强度：",-1)),o("div",he,[o("div",{class:oe(["strength-level",P.value]),style:ae({width:j.value})},null,6)]),o("span",be,z(J.value),1)])]),_:1}),s(p,{label:"确认新密码",prop:"confirmPassword"},{default:t(()=>[s(h,{modelValue:n.confirmPassword,"onUpdate:modelValue":e[3]||(e[3]=m=>n.confirmPassword=m),type:"password",placeholder:"请再次输入新密码",size:"large","show-password":""},{prefix:t(()=>[s(a,null,{default:t(()=>[s(u(q))]),_:1})]),_:1},8,["modelValue"])]),_:1}),s(p,null,{default:t(()=>[s(v,{type:"primary",size:"large",style:{width:"100%"},onClick:Q,loading:x.value},{default:t(()=>[...e[9]||(e[9]=[_(" 重置密码 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])],512),[[V,r.value===2]]),k(o("div",ke,[o("div",Ve,[s(a,{size:80,color:"#67c23a"},{default:t(()=>[s(u(ne))]),_:1})]),e[11]||(e[11]=o("h2",null,"密码重置成功！",-1)),e[12]||(e[12]=o("p",null,"您的密码已成功重置，请使用新密码登录",-1)),s(v,{type:"primary",size:"large",onClick:X},{default:t(()=>[...e[10]||(e[10]=[_(" 立即登录 ",-1)])]),_:1})],512),[[V,r.value===3]]),r.value<3?($(),B("div",ze,[s(ee,{to:"/login"},{default:t(()=>[s(a,null,{default:t(()=>[s(u(ie))]),_:1}),e[13]||(e[13]=_(" 返回登录 ",-1))]),_:1})])):le("",!0)])])}}},Se=se(Ce,[["__scopeId","data-v-69ce7610"]]);export{Se as default};
