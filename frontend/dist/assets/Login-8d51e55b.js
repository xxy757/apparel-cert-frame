import{_ as E,g as G,r as V,D as A,h as H,G as z,o as J,H as K,i as v,j as b,k as S,n as k,q as r,w as s,y as w,B as C,I as R,x as _}from"./index-94722956.js";import{r as O}from"./request-95526739.js";const Q={name:"Login",setup(){const T=G(),o=V(!1),x=V("personal"),e=A({username:"",password:""}),c=A({username:"",password:""}),g=V(null),n=V(null),i=5,m=300,t=A({personal:0,enterprise:0}),d=A({personal:null,enterprise:null}),u=V(0);let f=null;const I=H(()=>{const l=x.value;return t[l]>=i&&u.value>0}),a=l=>{d[l]=Date.now(),u.value=m,f&&clearInterval(f),f=setInterval(()=>{const p=Math.floor((Date.now()-d[l])/1e3);u.value=Math.max(0,m-p),u.value<=0&&(clearInterval(f),t[l]=0,d[l]=null)},1e3)},y=l=>{if(d[l]){const p=Math.floor((Date.now()-d[l])/1e3);if(p<m)return u.value=m-p,a(l),!0;t[l]=0,d[l]=null}return!1},D={username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},M=async l=>{if(I.value){w.error(`账号已锁定，请 ${u.value} 秒后重试`);return}const p=l==="personal"?g:n,U=l==="personal"?e:c;if(!p.value){w.error("表单未加载");return}p.value.validate(async P=>{if(!P)return w.error("请填写完整的登录信息"),!1;o.value=!0;try{const L=l==="personal"?"/auth/login/personal":"/auth/login/enterprise",F=await O.post(L,{username:U.username,password:U.password});if(F.data&&F.data.token){t[l]=0,d[l]=null,localStorage.setItem("token",F.data.token),localStorage.setItem("userType",F.data.userType||(l==="personal"?"1":"2")),localStorage.setItem("userId",F.data.userId||""),localStorage.setItem("username",U.username),w.success("登录成功");const j=l==="personal"?"/personal/resume":"/enterprise/job";T.replace(j)}else t[l]++,t[l]>=i?(a(l),w.error(`登录失败次数过多，账号已锁定 ${m} 秒`)):w.error(F.message||`登录失败，还剩 ${i-t[l]} 次尝试机会`)}catch(L){console.error("登录失败:",L),t[l]++,t[l]>=i&&(a(l),w.error(`登录失败次数过多，账号已锁定 ${m} 秒`))}finally{o.value=!1}})},q=l=>{l==="personalForm"?(g.value.resetFields(),e.password=""):(n.value.resetFields(),c.password="")},N=()=>{w.info("忘记密码功能开发中")},B=()=>{e.username="",e.password="",c.username="",c.password="",g.value&&g.value.clearValidate(),n.value&&n.value.clearValidate()};return z(x,(l,p)=>{y(l),p==="personal"?(e.username="",e.password="",g.value&&g.value.clearValidate()):p==="enterprise"&&(c.username="",c.password="",n.value&&n.value.clearValidate())}),J(()=>{localStorage.removeItem("savedPassword"),localStorage.removeItem("savedUsername"),B(),y("personal"),y("enterprise")}),K(()=>{B(),f&&clearInterval(f)}),{activeTab:x,loading:o,personalForm:e,enterpriseForm:c,personalFormRef:g,enterpriseFormRef:n,rules:D,login:M,resetForm:q,forgetPassword:N,maxAttempts:i,loginAttempts:t,lockCountdown:u,isLocked:I}}},W={class:"login-container"},X={class:"login-box"},Y={class:"login-tabs"},Z={key:0,class:"login-warning"},h={class:"login-actions"},$={class:"login-footer"},ee={key:0,class:"login-warning"},oe={class:"login-actions"},le={class:"login-footer"};function re(T,o,x,e,c,g){const n=v("el-input"),i=v("el-form-item"),m=v("el-alert"),t=v("el-button"),d=v("router-link"),u=v("el-form"),f=v("el-tab-pane"),I=v("el-tabs");return b(),S("div",W,[k("div",X,[o[17]||(o[17]=k("h2",null,"服装行业人才技能认证与招聘服务平台",-1)),k("div",Y,[r(I,{modelValue:e.activeTab,"onUpdate:modelValue":o[8]||(o[8]=a=>e.activeTab=a),type:"card"},{default:s(()=>[r(f,{label:"个人登录",name:"personal"},{default:s(()=>[r(u,{ref:"personalFormRef",model:e.personalForm,rules:e.rules,"label-width":"80px"},{default:s(()=>[r(i,{label:"用户名",prop:"username"},{default:s(()=>[r(n,{modelValue:e.personalForm.username,"onUpdate:modelValue":o[0]||(o[0]=a=>e.personalForm.username=a),placeholder:"请输入用户名",autocomplete:"off"},null,8,["modelValue"])]),_:1}),r(i,{label:"密码",prop:"password"},{default:s(()=>[r(n,{modelValue:e.personalForm.password,"onUpdate:modelValue":o[1]||(o[1]=a=>e.personalForm.password=a),type:"password",placeholder:"请输入密码",autocomplete:"new-password"},null,8,["modelValue"])]),_:1}),e.loginAttempts.personal>0?(b(),S("div",Z,[e.loginAttempts.personal<e.maxAttempts?(b(),C(m,{key:0,title:`登录失败，还剩 ${e.maxAttempts-e.loginAttempts.personal} 次尝试机会`,type:"warning",closable:!1,"show-icon":""},null,8,["title"])):(b(),C(m,{key:1,title:`账号已锁定，请 ${e.lockCountdown} 秒后重试`,type:"error",closable:!1,"show-icon":""},null,8,["title"]))])):R("",!0),r(i,null,{default:s(()=>[k("div",h,[r(t,{type:"primary",onClick:o[2]||(o[2]=a=>e.login("personal")),loading:e.loading,disabled:e.isLocked},{default:s(()=>[...o[9]||(o[9]=[_("登录",-1)])]),_:1},8,["loading","disabled"]),r(t,{onClick:o[3]||(o[3]=a=>e.resetForm("personalForm"))},{default:s(()=>[...o[10]||(o[10]=[_("重置",-1)])]),_:1})])]),_:1}),k("div",$,[r(d,{to:"/forgot-password"},{default:s(()=>[...o[11]||(o[11]=[_("忘记密码？",-1)])]),_:1}),r(d,{to:"/register",style:{"margin-left":"20px"}},{default:s(()=>[...o[12]||(o[12]=[_("立即注册",-1)])]),_:1})])]),_:1},8,["model","rules"])]),_:1}),r(f,{label:"企业登录",name:"enterprise"},{default:s(()=>[r(u,{ref:"enterpriseFormRef",model:e.enterpriseForm,rules:e.rules,"label-width":"80px"},{default:s(()=>[r(i,{label:"用户名",prop:"username"},{default:s(()=>[r(n,{modelValue:e.enterpriseForm.username,"onUpdate:modelValue":o[4]||(o[4]=a=>e.enterpriseForm.username=a),placeholder:"请输入用户名",autocomplete:"off"},null,8,["modelValue"])]),_:1}),r(i,{label:"密码",prop:"password"},{default:s(()=>[r(n,{modelValue:e.enterpriseForm.password,"onUpdate:modelValue":o[5]||(o[5]=a=>e.enterpriseForm.password=a),type:"password",placeholder:"请输入密码",autocomplete:"new-password"},null,8,["modelValue"])]),_:1}),e.loginAttempts.enterprise>0?(b(),S("div",ee,[e.loginAttempts.enterprise<e.maxAttempts?(b(),C(m,{key:0,title:`登录失败，还剩 ${e.maxAttempts-e.loginAttempts.enterprise} 次尝试机会`,type:"warning",closable:!1,"show-icon":""},null,8,["title"])):(b(),C(m,{key:1,title:`账号已锁定，请 ${e.lockCountdown} 秒后重试`,type:"error",closable:!1,"show-icon":""},null,8,["title"]))])):R("",!0),r(i,null,{default:s(()=>[k("div",oe,[r(t,{type:"primary",onClick:o[6]||(o[6]=a=>e.login("enterprise")),loading:e.loading,disabled:e.isLocked},{default:s(()=>[...o[13]||(o[13]=[_("登录",-1)])]),_:1},8,["loading","disabled"]),r(t,{onClick:o[7]||(o[7]=a=>e.resetForm("enterpriseForm"))},{default:s(()=>[...o[14]||(o[14]=[_("重置",-1)])]),_:1})])]),_:1}),k("div",le,[r(d,{to:"/forgot-password"},{default:s(()=>[...o[15]||(o[15]=[_("忘记密码？",-1)])]),_:1}),r(d,{to:"/register",style:{"margin-left":"20px"}},{default:s(()=>[...o[16]||(o[16]=[_("立即注册",-1)])]),_:1})])]),_:1},8,["model","rules"])]),_:1})]),_:1},8,["modelValue"])])])])}const te=E(Q,[["render",re],["__scopeId","data-v-c09d6b8e"]]);export{te as default};
