import{_ as ae,y as le,r as v,P as N,o as se,e as _,f as c,g as p,h as n,i as a,w as l,t as x,H as y,Z as ne,E as D,R as A,x as u,S as g,n as i,F as oe,j as ie,Q as de,q as re,v as ce,C as R,$ as ue,N as _e,a0 as fe,m as B,W as E,b as O,a1 as L,c as ve}from"./index-a65af770.js";import{r as h}from"./request-32baecc7.js";const pe={class:"messages-container"},ge={class:"page-header"},me={class:"header-left"},ye={class:"subtitle"},be={class:"header-actions"},he={class:"message-tabs"},ke={class:"messages-list"},we=["onClick"],Ce={class:"message-content"},Te={class:"message-header"},Me={class:"message-title"},xe={class:"message-time"},De={class:"message-summary"},Re={key:0,class:"message-footer"},Se={class:"message-actions"},Ve={key:0,class:"load-more"},$e={key:0,class:"message-detail"},Ue={class:"detail-meta"},je={class:"detail-time"},Ie={class:"detail-content"},ze={key:0,class:"detail-action"},Ne={__name:"Messages",setup(Ae){const q=le(),k=v("all"),d=v([]),T=v(!1),S=v(!0),F=v(1),w=v(!1),r=v(null),C=N(()=>d.value.filter(t=>!t.isRead).length),V=N(()=>k.value==="all"?d.value:d.value.filter(t=>t.type===k.value)),P=t=>({certification:B,interview:E,job:O,system:L})[t]||ue,$=t=>({certification:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",interview:"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)",job:"linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)",system:"linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)"})[t]||"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",G=t=>({certification:"认证通知",interview:"面试邀请",job:"职位推荐",system:"系统通知"})[t]||"通知",U=t=>{if(!t)return"";const e=new Date(t),o=new Date-e;return o<6e4?"刚刚":o<36e5?`${Math.floor(o/6e4)} 分钟前`:o<864e5?`${Math.floor(o/36e5)} 小时前`:e.toLocaleDateString("zh-CN")},H=t=>{r.value=t,w.value=!0,t.isRead||j(t)},j=async t=>{try{await h.post(`/api/notification/${t.id}/read`)}catch{}t.isRead=!0},Q=async()=>{try{await h.post("/api/notification/read-all")}catch{}d.value.forEach(t=>t.isRead=!0),D.success("已全部标记为已读")},W=t=>{A.confirm("确定删除这条消息吗？","删除确认",{type:"warning"}).then(async()=>{try{await h.delete(`/api/notification/${t.id}`)}catch{}const e=d.value.findIndex(m=>m.id===t.id);e>-1&&d.value.splice(e,1),D.success("删除成功")}).catch(()=>{})},Z=()=>{A.confirm("确定清空所有消息吗？此操作不可撤销","清空确认",{type:"warning"}).then(async()=>{try{await h.delete("/api/notification/clear-all")}catch{}d.value=[],D.success("已清空所有消息")}).catch(()=>{})},I=t=>{t.actionUrl&&(q.push(t.actionUrl),w.value=!1)},J=async()=>{T.value=!0,F.value++,setTimeout(()=>{T.value=!1,S.value=!1},1e3)},K=async()=>{try{const t=await h.get("/api/notification/list");d.value=t.data||[]}catch{d.value=[{id:1,type:"certification",title:"认证申请已通过",content:'恭喜！您的"服装设计师（中级）"认证申请已通过审核，证书将在3个工作日内发放。',createTime:new Date().toISOString(),isRead:!1,actionUrl:"/personal/certification",actionText:"查看证书"},{id:2,type:"interview",title:"收到面试邀请",content:'上海时尚服饰有限公司邀请您参加"高级服装设计师"职位的面试，请在24小时内确认。',createTime:new Date(Date.now()-36e5).toISOString(),isRead:!1,actionUrl:"/personal/applications",actionText:"查看详情"},{id:3,type:"job",title:"新职位推荐",content:"根据您的简历和技能认证，为您推荐5个高匹配度职位，快来看看吧！",createTime:new Date(Date.now()-864e5).toISOString(),isRead:!0,actionUrl:"/personal/job",actionText:"查看职位"},{id:4,type:"system",title:"系统维护通知",content:"平台将于本周六凌晨2:00-6:00进行系统升级维护，届时部分功能可能无法使用。",createTime:new Date(Date.now()-1728e5).toISOString(),isRead:!0}]}};return se(()=>{K()}),(t,e)=>{var z;const m=_("el-badge"),o=_("el-icon"),f=_("el-button"),b=_("el-radio-button"),X=_("el-radio-group"),Y=_("el-empty"),ee=_("el-tag"),te=_("el-dialog");return c(),p("div",pe,[n("div",ge,[n("div",me,[e[3]||(e[3]=n("h1",null,"消息中心",-1)),a(m,{value:C.value,hidden:C.value===0,class:"unread-badge"},{default:l(()=>[n("span",ye,"您有 "+u(C.value)+" 条未读消息",1)]),_:1},8,["value","hidden"])]),n("div",be,[a(f,{onClick:Q,disabled:C.value===0},{default:l(()=>[a(o,null,{default:l(()=>[a(g(_e))]),_:1}),e[4]||(e[4]=i(" 全部已读 ",-1))]),_:1},8,["disabled"]),a(f,{type:"danger",plain:"",onClick:Z,disabled:d.value.length===0},{default:l(()=>[a(o,null,{default:l(()=>[a(g(fe))]),_:1}),e[5]||(e[5]=i(" 清空消息 ",-1))]),_:1},8,["disabled"])])]),n("div",he,[a(X,{modelValue:k.value,"onUpdate:modelValue":e[0]||(e[0]=s=>k.value=s),size:"large"},{default:l(()=>[a(b,{label:"all"},{default:l(()=>[e[6]||(e[6]=i(" 全部消息 ",-1)),a(m,{value:d.value.length,hidden:d.value.length===0},null,8,["value","hidden"])]),_:1}),a(b,{label:"certification"},{default:l(()=>[a(o,null,{default:l(()=>[a(g(B))]),_:1}),e[7]||(e[7]=i(" 认证通知 ",-1))]),_:1}),a(b,{label:"interview"},{default:l(()=>[a(o,null,{default:l(()=>[a(g(E))]),_:1}),e[8]||(e[8]=i(" 面试邀请 ",-1))]),_:1}),a(b,{label:"job"},{default:l(()=>[a(o,null,{default:l(()=>[a(g(O))]),_:1}),e[9]||(e[9]=i(" 职位推荐 ",-1))]),_:1}),a(b,{label:"system"},{default:l(()=>[a(o,null,{default:l(()=>[a(g(L))]),_:1}),e[10]||(e[10]=i(" 系统通知 ",-1))]),_:1})]),_:1},8,["modelValue"])]),n("div",ke,[V.value.length===0?(c(),x(Y,{key:0,description:"暂无消息"})):y("",!0),a(ne,{name:"message",tag:"div"},{default:l(()=>[(c(!0),p(oe,null,ie(V.value,s=>(c(),p("div",{key:s.id,class:de(["message-card",{unread:!s.isRead}]),onClick:M=>H(s)},[n("div",{class:"message-icon",style:re({background:$(s.type)})},[a(o,null,{default:l(()=>[(c(),x(ce(P(s.type))))]),_:2},1024)],4),n("div",Ce,[n("div",Te,[n("h3",Me,u(s.title),1),n("span",xe,u(U(s.createTime)),1)]),n("p",De,u(s.content),1),s.actionUrl?(c(),p("div",Re,[a(f,{type:"primary",link:"",size:"small",onClick:R(M=>I(s),["stop"])},{default:l(()=>[i(u(s.actionText||"查看详情")+" ",1),a(o,null,{default:l(()=>[a(g(ve))]),_:1})]),_:2},1032,["onClick"])])):y("",!0)]),n("div",Se,[s.isRead?y("",!0):(c(),x(f,{key:0,type:"primary",link:"",onClick:R(M=>j(s),["stop"])},{default:l(()=>[...e[11]||(e[11]=[i(" 标记已读 ",-1)])]),_:1},8,["onClick"])),a(f,{type:"danger",link:"",onClick:R(M=>W(s),["stop"])},{default:l(()=>[...e[12]||(e[12]=[i(" 删除 ",-1)])]),_:1},8,["onClick"])])],10,we))),128))]),_:1})]),S.value?(c(),p("div",Ve,[a(f,{onClick:J,loading:T.value},{default:l(()=>[...e[13]||(e[13]=[i("加载更多",-1)])]),_:1},8,["loading"])])):y("",!0),a(te,{modelValue:w.value,"onUpdate:modelValue":e[2]||(e[2]=s=>w.value=s),title:(z=r.value)==null?void 0:z.title,width:"600px"},{default:l(()=>[r.value?(c(),p("div",$e,[n("div",Ue,[a(ee,{color:$(r.value.type),effect:"dark",size:"small"},{default:l(()=>[i(u(G(r.value.type)),1)]),_:1},8,["color"]),n("span",je,u(U(r.value.createTime)),1)]),n("div",Ie,u(r.value.content),1),r.value.actionUrl?(c(),p("div",ze,[a(f,{type:"primary",onClick:e[1]||(e[1]=s=>I(r.value))},{default:l(()=>[i(u(r.value.actionText||"查看详情"),1)]),_:1})])):y("",!0)])):y("",!0)]),_:1},8,["modelValue","title"])])}}},Oe=ae(Ne,[["__scopeId","data-v-4d4e663c"]]);export{Oe as default};
