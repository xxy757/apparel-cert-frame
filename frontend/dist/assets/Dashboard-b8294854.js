import{_ as te,r as k,K as z,L as se,o as ae,av as V,M as re,j as _,a4 as ne,S as oe,k as le,n as ie,q as s,t,w as a,D as E,R as S,y as g,G as b,aJ as de,u as ce,W as ue,af as pe,ao as me}from"./index-3d929bd0.js";import{r as P}from"./request-9595d616.js";import{i as $}from"./index-18acf776.js";const fe={class:"dashboard"},_e={class:"page-header"},ye={class:"stat-content"},ve={class:"stat-icon"},we={class:"stat-info"},he={class:"stat-value"},be={class:"stat-content"},ge={class:"stat-icon"},Ne={class:"stat-info"},xe={class:"stat-value"},ke={class:"stat-content"},Ee={class:"stat-icon"},Ce={class:"stat-info"},De={class:"stat-value"},Se={class:"stat-content"},Pe={class:"stat-icon"},Re={class:"stat-info"},ze={class:"stat-value"},Ae={class:"summary-card"},Ue={class:"summary-value"},Te={class:"summary-card"},Ie={class:"summary-value"},Ve={class:"summary-card"},$e={class:"summary-value"},Le={class:"summary-card"},Be={class:"summary-value"},Me={class:"card-header"},Oe={class:"card-header"},je={__name:"Dashboard",setup(qe){const A=k(!1),N=k(7),y=z({totalPersonalUsers:0,totalEnterpriseUsers:0,totalAdminUsers:0,pendingEnterpriseUsers:0,approvedEnterpriseUsers:0}),u=z({monthlyNew:0,dailyActive:0,retentionRate:0,certificationRate:0}),d=z({labels:[],personal:[],enterprise:[],total:[]}),o=z({todayNewPersonal:0,todayNewEnterprise:0,weekNewPersonal:0,weekNewEnterprise:0,monthNewPersonal:0,monthNewEnterprise:0}),R=k([]),U=k(null),T=k(null),I=k(null);let v=null,w=null,h=null;const G=async()=>{try{const r=await P.get("/admin/user/statistics");return r.data&&Object.assign(y,r.data),!0}catch(r){return console.error("加载基础统计失败:",r),!1}},W=r=>{const e=[],n=new Date;n.setHours(0,0,0,0);for(let c=r-1;c>=0;c--){const l=new Date(n);l.setDate(n.getDate()-c);const i=String(l.getMonth()+1).padStart(2,"0"),p=String(l.getDate()).padStart(2,"0");e.push(`${i}-${p}`)}return e},L=()=>{const r=W(N.value);d.labels=r,d.personal=r.map(()=>0),d.enterprise=r.map(()=>0),d.total=r.map(()=>0)},B=async()=>{try{const e=(await P.get("/admin/user/statistics/trend",{params:{days:N.value}})).data||{},n=e.personalTrend||[],c=e.enterpriseTrend||[];if(n.length===0&&c.length===0)return L(),u.monthlyNew=e.monthlyNew||0,!0;const l=n.map(m=>m.date),i=n.map(m=>Number(m.count)||0),p=c.map(m=>Number(m.count)||0),C=i.map((m,f)=>m+(p[f]||0));return d.labels=l,d.personal=i,d.enterprise=p,d.total=C,u.monthlyNew=e.monthlyNew||0,!0}catch(r){return console.error("加载趋势统计失败:",r),L(),!1}},H=()=>{u.dailyActive=0,u.retentionRate=0,u.certificationRate=0,o.todayNewPersonal=0,o.todayNewEnterprise=0,o.weekNewPersonal=0,o.weekNewEnterprise=0,o.monthNewPersonal=0,o.monthNewEnterprise=0},J=async()=>{try{const e=(await P.get("/admin/user/statistics/activity")).data||{};return u.dailyActive=e.dailyActive||0,u.retentionRate=e.retentionRate||0,u.certificationRate=e.certificationRate||0,o.todayNewPersonal=e.todayNewPersonal||0,o.todayNewEnterprise=e.todayNewEnterprise||0,o.weekNewPersonal=e.weekNewPersonal||0,o.weekNewEnterprise=e.weekNewEnterprise||0,o.monthNewPersonal=e.monthNewPersonal||0,o.monthNewEnterprise=e.monthNewEnterprise||0,!0}catch(r){return console.error("加载活跃统计失败:",r),H(),!1}},K=async()=>{try{const r=await P.get("/admin/user/enterprise",{params:{page:1,size:5,authStatus:0}});return r.data&&r.data.records?R.value=r.data.records:R.value=[],!0}catch(r){return console.error("加载待审核企业失败:",r),R.value=[],!1}},M=async()=>{A.value=!0;try{(await Promise.all([G(),B(),J(),K()])).some(e=>!e)&&E.warning("部分统计数据加载失败，已展示可用数据")}finally{A.value=!1}},O=async(r=!1)=>{try{await M(),await V(),F(),setTimeout(()=>{x()},120),r||E.success("数据已刷新")}catch(e){console.error("刷新仪表盘失败:",e),E.error("刷新失败，请稍后重试")}},j=async(r,e)=>{try{await P.put("/admin/user/enterprise/audit",null,{params:{userId:r.id,authStatus:e}}),E.success(e===1?"审核通过":"已拒绝"),await O(!0)}catch(n){console.error("审核企业失败:",n),E.error("操作失败")}},q=()=>{if(!U.value)return;v||(v=$(U.value));const e=[...d.total||[],...d.personal||[],...d.enterprise||[]].some(c=>Number(c)>0),n={tooltip:{trigger:"axis"},legend:{data:["当日新增合计","个人新增","企业新增"]},grid:{left:24,right:24,top:40,bottom:24,containLabel:!0},xAxis:{type:"category",data:d.labels,boundaryGap:!1},yAxis:{type:"value",minInterval:1},series:[{name:"当日新增合计",type:"line",smooth:!0,data:d.total,lineStyle:{width:3,color:"#6366f1"},itemStyle:{color:"#6366f1"},areaStyle:{color:"rgba(99, 102, 241, 0.15)"}},{name:"个人新增",type:"line",smooth:!0,data:d.personal,lineStyle:{width:2,color:"#10b981"},itemStyle:{color:"#10b981"}},{name:"企业新增",type:"line",smooth:!0,data:d.enterprise,lineStyle:{width:2,color:"#f97316"},itemStyle:{color:"#f97316"}}],graphic:e?[]:[{type:"text",left:"center",top:"middle",style:{text:`近${N.value}天暂无新增数据`,fill:"#9ca3af",font:"14px sans-serif"}}]};v.setOption(n)},Q=()=>{if(!T.value)return;w||(w=$(T.value));const r={tooltip:{trigger:"item",formatter:"{b}: {c} ({d}%)"},legend:{bottom:0},series:[{type:"pie",radius:["36%","68%"],label:{show:!1},emphasis:{label:{show:!0,fontSize:14,fontWeight:600}},data:[{value:y.totalPersonalUsers,name:"个人用户"},{value:y.totalEnterpriseUsers,name:"企业用户"},{value:y.totalAdminUsers,name:"管理员"}]}]};w.setOption(r)},X=()=>{if(!I.value)return;h||(h=$(I.value));const r=[o.todayNewPersonal,o.weekNewPersonal,o.monthNewPersonal],e=[o.todayNewEnterprise,o.weekNewEnterprise,o.monthNewEnterprise],n=[...r,...e].some(l=>Number(l)>0),c={tooltip:{trigger:"axis"},legend:{data:["个人新增","企业新增"]},grid:{left:24,right:24,top:40,bottom:24,containLabel:!0},xAxis:{type:"category",data:["今日新增","本周新增","本月新增"]},yAxis:{type:"value",minInterval:1},series:[{name:"个人新增",type:"bar",stack:"total",itemStyle:{color:"#34d399"},data:r},{name:"企业新增",type:"bar",stack:"total",itemStyle:{color:"#f97316"},data:e}],graphic:n?[]:[{type:"text",left:"center",top:"middle",style:{text:"暂无活跃新增数据",fill:"#9ca3af",font:"14px sans-serif"}}]};h.setOption(c)},x=()=>{v&&v.resize(),w&&w.resize(),h&&h.resize()},F=()=>{q(),Q(),X(),x()};return se(N,async()=>{const r=await B();await V(),q(),x(),r||E.warning("趋势数据加载失败，已使用空数据展示")}),ae(async()=>{await M(),await V(),F(),setTimeout(()=>{x()},120),window.addEventListener("resize",x)}),re(()=>{window.removeEventListener("resize",x),v&&v.dispose(),w&&w.dispose(),h&&h.dispose(),v=null,w=null,h=null}),(r,e)=>{const n=_("el-icon"),c=_("el-button"),l=_("el-card"),i=_("el-col"),p=_("el-row"),C=_("el-radio-button"),m=_("el-radio-group"),f=_("el-table-column"),Y=_("el-table"),Z=ne("loading");return oe((le(),ie("div",fe,[s("div",_e,[e[3]||(e[3]=s("h2",null,"管理员仪表盘",-1)),t(c,{type:"primary",plain:"",onClick:O},{default:a(()=>[t(n,null,{default:a(()=>[t(S(de))]),_:1}),e[2]||(e[2]=g(" 刷新数据 ",-1))]),_:1})]),t(p,{gutter:20,class:"stats-row"},{default:a(()=>[t(i,{xs:24,sm:12,lg:6},{default:a(()=>[t(l,{class:"stat-card personal"},{default:a(()=>[s("div",ye,[s("div",ve,[t(n,{size:36},{default:a(()=>[t(S(ce))]),_:1})]),s("div",we,[e[4]||(e[4]=s("p",{class:"stat-label"},"个人用户",-1)),s("p",he,b(y.totalPersonalUsers),1)])])]),_:1})]),_:1}),t(i,{xs:24,sm:12,lg:6},{default:a(()=>[t(l,{class:"stat-card enterprise"},{default:a(()=>[s("div",be,[s("div",ge,[t(n,{size:36},{default:a(()=>[t(S(ue))]),_:1})]),s("div",Ne,[e[5]||(e[5]=s("p",{class:"stat-label"},"企业用户",-1)),s("p",xe,b(y.totalEnterpriseUsers),1)])])]),_:1})]),_:1}),t(i,{xs:24,sm:12,lg:6},{default:a(()=>[t(l,{class:"stat-card pending"},{default:a(()=>[s("div",ke,[s("div",Ee,[t(n,{size:36},{default:a(()=>[t(S(pe))]),_:1})]),s("div",Ce,[e[6]||(e[6]=s("p",{class:"stat-label"},"待审核企业",-1)),s("p",De,b(y.pendingEnterpriseUsers),1)])])]),_:1})]),_:1}),t(i,{xs:24,sm:12,lg:6},{default:a(()=>[t(l,{class:"stat-card approved"},{default:a(()=>[s("div",Se,[s("div",Pe,[t(n,{size:36},{default:a(()=>[t(S(me))]),_:1})]),s("div",Re,[e[7]||(e[7]=s("p",{class:"stat-label"},"已审核企业",-1)),s("p",ze,b(y.approvedEnterpriseUsers),1)])])]),_:1})]),_:1})]),_:1}),t(p,{gutter:20,class:"summary-row"},{default:a(()=>[t(i,{xs:12,sm:12,md:6},{default:a(()=>[s("div",Ae,[e[8]||(e[8]=s("div",{class:"summary-label"},"本月新增",-1)),s("div",Ue,b(u.monthlyNew),1)])]),_:1}),t(i,{xs:12,sm:12,md:6},{default:a(()=>[s("div",Te,[e[9]||(e[9]=s("div",{class:"summary-label"},"日均活跃",-1)),s("div",Ie,b(u.dailyActive),1)])]),_:1}),t(i,{xs:12,sm:12,md:6},{default:a(()=>[s("div",Ve,[e[10]||(e[10]=s("div",{class:"summary-label"},"留存率",-1)),s("div",$e,b(u.retentionRate)+"%",1)])]),_:1}),t(i,{xs:12,sm:12,md:6},{default:a(()=>[s("div",Le,[e[11]||(e[11]=s("div",{class:"summary-label"},"企业认证率",-1)),s("div",Be,b(u.certificationRate)+"%",1)])]),_:1})]),_:1}),t(p,{gutter:20,class:"chart-row"},{default:a(()=>[t(i,{xs:24,lg:16},{default:a(()=>[t(l,{class:"chart-card"},{header:a(()=>[s("div",Me,[e[15]||(e[15]=s("span",null,"用户增长趋势",-1)),t(m,{modelValue:N.value,"onUpdate:modelValue":e[0]||(e[0]=D=>N.value=D),size:"small"},{default:a(()=>[t(C,{label:7},{default:a(()=>[...e[12]||(e[12]=[g("近7天",-1)])]),_:1}),t(C,{label:15},{default:a(()=>[...e[13]||(e[13]=[g("近15天",-1)])]),_:1}),t(C,{label:30},{default:a(()=>[...e[14]||(e[14]=[g("近30天",-1)])]),_:1})]),_:1},8,["modelValue"])])]),default:a(()=>[s("div",{ref_key:"trendChartRef",ref:U,class:"chart"},null,512)]),_:1})]),_:1}),t(i,{xs:24,lg:8},{default:a(()=>[t(l,{class:"chart-card"},{header:a(()=>[...e[16]||(e[16]=[s("div",{class:"card-header"},[s("span",null,"用户类型分布")],-1)])]),default:a(()=>[s("div",{ref_key:"distributionChartRef",ref:T,class:"chart"},null,512)]),_:1})]),_:1})]),_:1}),t(p,{gutter:20,class:"chart-row"},{default:a(()=>[t(i,{xs:24},{default:a(()=>[t(l,{class:"chart-card"},{header:a(()=>[...e[17]||(e[17]=[s("div",{class:"card-header"},[s("span",null,"新增用户活跃分析")],-1)])]),default:a(()=>[s("div",{ref_key:"activityChartRef",ref:I,class:"chart"},null,512)]),_:1})]),_:1})]),_:1}),t(l,{class:"pending-list"},{header:a(()=>[s("div",Oe,[e[19]||(e[19]=s("span",null,"待审核企业",-1)),t(c,{type:"primary",size:"small",onClick:e[1]||(e[1]=D=>r.$router.push("/admin/user"))},{default:a(()=>[...e[18]||(e[18]=[g("查看全部",-1)])]),_:1})])]),default:a(()=>[t(Y,{data:R.value,style:{width:"100%"}},{default:a(()=>[t(f,{prop:"id",label:"ID",width:"80"}),t(f,{prop:"companyName",label:"企业名称"}),t(f,{prop:"username",label:"用户名"}),t(f,{prop:"contactPerson",label:"联系人"}),t(f,{prop:"contactPhone",label:"联系电话"}),t(f,{prop:"email",label:"邮箱"}),t(f,{label:"操作",width:"180"},{default:a(D=>[t(c,{type:"success",size:"small",onClick:ee=>j(D.row,1)},{default:a(()=>[...e[20]||(e[20]=[g("通过",-1)])]),_:1},8,["onClick"]),t(c,{type:"danger",size:"small",onClick:ee=>j(D.row,2)},{default:a(()=>[...e[21]||(e[21]=[g("拒绝",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})])),[[Z,A.value]])}}},He=te(je,[["__scopeId","data-v-47a7e9d5"]]);export{He as default};
