import{r as x}from"./request-9595d616.js";import{_ as H,r as v,K as R,o as J,D as c,j as p,a4 as O,k as C,n as L,t as a,w as l,q as _,y as m,G as q,I as V,Q as X,S as Y}from"./index-3d929bd0.js";const Z={name:"CertificationManage",setup(){const z=v(null),r=v(!1),f=R({username:"",certType:"",status:""}),t=R({certType:"designer",certName:"",certLevel:"1",examFee:0,validityPeriod:3,certStandard:""}),I={certType:[{required:!0,message:"请选择认证类型",trigger:"change"}],certName:[{required:!0,message:"请输入认证名称",trigger:"blur"}],certLevel:[{required:!0,message:"请选择认证等级",trigger:"change"}],examFee:[{required:!0,message:"请输入考试费用",trigger:"blur"},{type:"number",min:0,message:"考试费用必须大于等于0",trigger:"blur"}],validityPeriod:[{required:!0,message:"请输入有效期",trigger:"blur"},{type:"number",min:1,message:"有效期必须大于等于1",trigger:"blur"}],certStandard:[{required:!0,message:"请输入认证标准详情",trigger:"blur"}]},h=v([]),s=v([]),y=v(!1),u=v(1),i=v(10),w=v(0),F=v(!1),d=v("");J(()=>{g(),k()});const g=async()=>{try{const e=await x.get("/personal/certification/page",{params:{page:u.value,size:i.value}}),o=e.data.records||[];h.value=o.filter(b=>!(f.certType&&b.certificationType!==f.certType||f.status!==""&&String(b.status)!==String(f.status)||f.username&&b.userName&&!b.userName.includes(f.username))).map(b=>G(b)),w.value=e.data.total||h.value.length}catch(e){console.error("加载认证申请失败:",e),c.error("加载认证申请失败"),h.value=[],w.value=0}},M=e=>({1:"初级",2:"中级",3:"高级",4:"专家级"})[e]||String(e||""),U=e=>{const o=e.type||e.jobType;return{...e,certType:o,certTypeText:T(o),levelText:M(e.level)}},k=async()=>{var e;y.value=!0;try{const b=((e=(await x.get("/admin/certification/standard",{params:{page:1,size:200}})).data)==null?void 0:e.records)||[];s.value=b.map(A=>U(A))}catch(o){console.error("加载认证标准失败:",o),c.error("加载认证标准失败"),s.value=[]}finally{y.value=!1}},D=()=>{g()},N=()=>{f.username="",f.certType="",f.status="",g()},T=e=>({designer:"设计师",patternmaker:"打版师",inspector:"质检员",sales:"导购"})[e]||"未知",P=e=>({designer:"info",patternmaker:"success",inspector:"warning",sales:"primary"})[e]||"info",n=e=>({0:"待提交图片",1:"待审核",2:"审核拒绝",3:"审核通过"})[e]||"未知",S=e=>({0:"info",1:"warning",2:"danger",3:"success"})[e]||"info",j=e=>e?/^https?:\/\//i.test(e)?e:`${window.location.origin}${e.startsWith("/")?"":"/"}${e}`:"",B=e=>[0,1].includes(Number(e==null?void 0:e.status)),E=e=>{const o=j((e==null?void 0:e.practicalFileUrl)||"");if(!o){c.warning("申请人尚未上传认证图片");return}d.value=o,F.value=!0},G=e=>{const o=T(e.certificationType);return{...e,certType:e.certificationType,certTypeText:o,levelText:e.level?`${e.level}级`:"",username:e.userName||e.userId||"用户",applyTime:e.applyTime||e.createTime,reviewTime:e.reviewTime,practicalFileUrl:e.practicalFileUrl||""}},K=()=>{t.certType="designer",t.certName="",t.certLevel="1",t.examFee=0,t.validityPeriod=3,t.certStandard="",r.value=!0},Q=()=>{z.value.validate(e=>{if(e)W();else return c.warning("请完善认证标准信息后再提交"),!1})},W=async()=>{try{await x.post("/admin/certification/standard",{type:t.certType,level:parseInt(t.certLevel,10),name:t.certName,description:t.certStandard,practicalRequirements:t.certStandard}),c.success("认证标准创建成功"),r.value=!1,k()}catch(e){console.error("创建认证标准失败:",e),c.error("创建认证标准失败")}};return{certStandardFormRef:z,createCertStandardDialogVisible:r,searchForm:f,certStandardForm:t,certStandardRules:I,certifications:h,certificationStandards:s,standardsLoading:y,currentPage:u,pageSize:i,totalCertifications:w,materialPreviewVisible:F,currentMaterialUrl:d,getCertTypeText:T,getCertTypeTagType:P,getStatusText:n,getStatusTagType:S,canReview:B,previewMaterial:E,openCreateCertStandardDialog:K,createCertStandard:Q,searchCertifications:D,resetSearch:N,viewCertDetails:e=>{const o=e.practicalFileUrl?"已上传":"未上传";c.info(`认证详情：${e.certTypeText}（${e.levelText}），图片材料：${o}`)},approveCert:async e=>{if(!(e!=null&&e.practicalFileUrl)){c.warning("申请人未上传认证图片，无法审核通过");return}try{await x.put("/personal/certification/admin/update-status",{certificationId:e.id,status:3,reviewComment:"审核通过"}),c.success("认证审核通过"),g()}catch(o){console.error("审核通过失败:",o),c.error("审核通过失败")}},rejectCert:async e=>{e!=null&&e.practicalFileUrl||c.warning("申请人未上传认证图片，可直接驳回并要求补充");try{await x.put("/personal/certification/admin/update-status",{certificationId:e.id,status:2,reviewComment:"审核拒绝"}),c.success("认证审核拒绝"),g()}catch(o){console.error("审核拒绝失败:",o),c.error("审核拒绝失败")}},viewCertificate:e=>{if(e.status!==3){c.warning("该认证尚未通过，无法查看证书");return}c.info("证书查看请到证书管理页面")},handleSizeChange:e=>{i.value=e,g()},handleCurrentChange:e=>{u.value=e,g()}}}},$={class:"certification-manage-container"},ee={class:"card-header"},ae={class:"certification-filters"},te={key:1},re={class:"pagination-container"},le={key:0,class:"material-preview"},ne={class:"dialog-footer"};function oe(z,r,f,t,I,h){const s=p("el-button"),y=p("el-input"),u=p("el-form-item"),i=p("el-option"),w=p("el-select"),F=p("el-form"),d=p("el-table-column"),g=p("el-tag"),M=p("el-table"),U=p("el-pagination"),k=p("el-card"),D=p("el-image"),N=p("el-empty"),T=p("el-dialog"),P=O("loading");return C(),L("div",$,[a(k,{shadow:"hover"},{header:l(()=>[_("div",ee,[r[14]||(r[14]=_("h2",null,"认证管理",-1)),a(s,{type:"primary",onClick:t.openCreateCertStandardDialog},{default:l(()=>[...r[13]||(r[13]=[m("创建认证标准",-1)])]),_:1},8,["onClick"])])]),default:l(()=>[_("div",ae,[a(F,{inline:!0,model:t.searchForm,"label-width":"80px"},{default:l(()=>[a(u,{label:"申请人"},{default:l(()=>[a(y,{modelValue:t.searchForm.username,"onUpdate:modelValue":r[0]||(r[0]=n=>t.searchForm.username=n),placeholder:"请输入申请人姓名"},null,8,["modelValue"])]),_:1}),a(u,{label:"认证类型"},{default:l(()=>[a(w,{modelValue:t.searchForm.certType,"onUpdate:modelValue":r[1]||(r[1]=n=>t.searchForm.certType=n),placeholder:"请选择认证类型"},{default:l(()=>[a(i,{label:"全部",value:""}),a(i,{label:"设计师",value:"designer"}),a(i,{label:"打版师",value:"patternmaker"}),a(i,{label:"质检员",value:"inspector"}),a(i,{label:"导购",value:"sales"})]),_:1},8,["modelValue"])]),_:1}),a(u,{label:"认证状态"},{default:l(()=>[a(w,{modelValue:t.searchForm.status,"onUpdate:modelValue":r[2]||(r[2]=n=>t.searchForm.status=n),placeholder:"请选择状态"},{default:l(()=>[a(i,{label:"全部",value:""}),a(i,{label:"待提交图片",value:"0"}),a(i,{label:"待审核",value:"1"}),a(i,{label:"审核通过",value:"3"}),a(i,{label:"审核拒绝",value:"2"})]),_:1},8,["modelValue"])]),_:1}),a(u,null,{default:l(()=>[a(s,{type:"primary",onClick:t.searchCertifications},{default:l(()=>[...r[15]||(r[15]=[m("查询",-1)])]),_:1},8,["onClick"]),a(s,{onClick:t.resetSearch},{default:l(()=>[...r[16]||(r[16]=[m("重置",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"])]),a(M,{data:t.certifications,style:{width:"100%"}},{default:l(()=>[a(d,{prop:"id",label:"认证ID",width:"100"}),a(d,{prop:"username",label:"申请人"}),a(d,{prop:"certTypeText",label:"认证类型",width:"120"},{default:l(n=>[a(g,{type:t.getCertTypeTagType(n.row.certType)},{default:l(()=>[m(q(t.getCertTypeText(n.row.certType)),1)]),_:2},1032,["type"])]),_:1}),a(d,{prop:"applyTime",label:"申请时间",width:"180"}),a(d,{prop:"status",label:"状态",width:"120"},{default:l(n=>[a(g,{type:t.getStatusTagType(n.row.status)},{default:l(()=>[m(q(t.getStatusText(n.row.status)),1)]),_:2},1032,["type"])]),_:1}),a(d,{label:"认证材料",width:"120"},{default:l(n=>[n.row.practicalFileUrl?(C(),V(s,{key:0,type:"primary",link:"",onClick:S=>t.previewMaterial(n.row)},{default:l(()=>[...r[17]||(r[17]=[m(" 查看图片 ",-1)])]),_:1},8,["onClick"])):(C(),L("span",te,"未上传"))]),_:1}),a(d,{prop:"reviewer",label:"审核人",width:"120"}),a(d,{prop:"reviewTime",label:"审核时间",width:"180"}),a(d,{label:"操作",width:"200",fixed:"right"},{default:l(n=>[a(s,{type:"primary",size:"small",onClick:S=>t.viewCertDetails(n.row)},{default:l(()=>[...r[18]||(r[18]=[m("查看详情",-1)])]),_:1},8,["onClick"]),t.canReview(n.row)?(C(),V(s,{key:0,type:"success",size:"small",onClick:S=>t.approveCert(n.row)},{default:l(()=>[...r[19]||(r[19]=[m("通过",-1)])]),_:1},8,["onClick"])):X("",!0),t.canReview(n.row)?(C(),V(s,{key:1,type:"danger",size:"small",onClick:S=>t.rejectCert(n.row)},{default:l(()=>[...r[20]||(r[20]=[m("拒绝",-1)])]),_:1},8,["onClick"])):(C(),V(s,{key:2,type:"warning",size:"small",onClick:S=>t.viewCertificate(n.row)},{default:l(()=>[...r[21]||(r[21]=[m("查看证书",-1)])]),_:1},8,["onClick"]))]),_:1})]),_:1},8,["data"]),_("div",re,[a(U,{onSizeChange:t.handleSizeChange,onCurrentChange:t.handleCurrentChange,"current-page":t.currentPage,"page-sizes":[10,20,50,100],"page-size":t.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:t.totalCertifications},null,8,["onSizeChange","onCurrentChange","current-page","page-size","total"])])]),_:1}),a(k,{shadow:"hover",class:"standard-list-card"},{header:l(()=>[...r[22]||(r[22]=[_("div",{class:"card-header"},[_("h2",null,"认证标准列表")],-1)])]),default:l(()=>[Y((C(),V(M,{data:t.certificationStandards,style:{width:"100%"}},{default:l(()=>[a(d,{prop:"id",label:"标准ID",width:"100"}),a(d,{prop:"name",label:"认证名称",width:"220"}),a(d,{prop:"certTypeText",label:"认证类型",width:"120"},{default:l(n=>[a(g,{type:t.getCertTypeTagType(n.row.certType)},{default:l(()=>[m(q(n.row.certTypeText),1)]),_:2},1032,["type"])]),_:1}),a(d,{prop:"levelText",label:"认证等级",width:"120"}),a(d,{prop:"description",label:"认证标准"}),a(d,{prop:"createTime",label:"创建时间",width:"180"})]),_:1},8,["data"])),[[P,t.standardsLoading]])]),_:1}),a(T,{modelValue:t.materialPreviewVisible,"onUpdate:modelValue":r[4]||(r[4]=n=>t.materialPreviewVisible=n),title:"认证图片材料",width:"700px"},{footer:l(()=>[a(s,{onClick:r[3]||(r[3]=n=>t.materialPreviewVisible=!1)},{default:l(()=>[...r[23]||(r[23]=[m("关闭",-1)])]),_:1})]),default:l(()=>[t.currentMaterialUrl?(C(),L("div",le,[a(D,{src:t.currentMaterialUrl,fit:"contain",style:{width:"100%","max-height":"520px"}},null,8,["src"])])):(C(),V(N,{key:1,description:"暂无图片材料"}))]),_:1},8,["modelValue"]),a(T,{modelValue:t.createCertStandardDialogVisible,"onUpdate:modelValue":r[12]||(r[12]=n=>t.createCertStandardDialogVisible=n),title:"创建认证标准",width:"600px"},{footer:l(()=>[_("span",ne,[a(s,{onClick:r[11]||(r[11]=n=>t.createCertStandardDialogVisible=!1)},{default:l(()=>[...r[24]||(r[24]=[m("取消",-1)])]),_:1}),a(s,{type:"primary",onClick:t.createCertStandard},{default:l(()=>[...r[25]||(r[25]=[m("确定",-1)])]),_:1},8,["onClick"])])]),default:l(()=>[a(F,{ref:"certStandardFormRef",model:t.certStandardForm,rules:t.certStandardRules,"label-width":"120px"},{default:l(()=>[a(u,{label:"认证类型",prop:"certType"},{default:l(()=>[a(w,{modelValue:t.certStandardForm.certType,"onUpdate:modelValue":r[5]||(r[5]=n=>t.certStandardForm.certType=n),placeholder:"请选择认证类型"},{default:l(()=>[a(i,{label:"设计师",value:"designer"}),a(i,{label:"打版师",value:"patternmaker"}),a(i,{label:"质检员",value:"inspector"}),a(i,{label:"导购",value:"sales"})]),_:1},8,["modelValue"])]),_:1}),a(u,{label:"认证名称",prop:"certName"},{default:l(()=>[a(y,{modelValue:t.certStandardForm.certName,"onUpdate:modelValue":r[6]||(r[6]=n=>t.certStandardForm.certName=n),placeholder:"请输入认证名称"},null,8,["modelValue"])]),_:1}),a(u,{label:"认证等级",prop:"certLevel"},{default:l(()=>[a(w,{modelValue:t.certStandardForm.certLevel,"onUpdate:modelValue":r[7]||(r[7]=n=>t.certStandardForm.certLevel=n),placeholder:"请选择认证等级"},{default:l(()=>[a(i,{label:"初级",value:"1"}),a(i,{label:"中级",value:"2"}),a(i,{label:"高级",value:"3"}),a(i,{label:"专家级",value:"4"})]),_:1},8,["modelValue"])]),_:1}),a(u,{label:"考试费用",prop:"examFee"},{default:l(()=>[a(y,{modelValue:t.certStandardForm.examFee,"onUpdate:modelValue":r[8]||(r[8]=n=>t.certStandardForm.examFee=n),modelModifiers:{number:!0},type:"number",placeholder:"请输入考试费用"},null,8,["modelValue"])]),_:1}),a(u,{label:"有效期(年)",prop:"validityPeriod"},{default:l(()=>[a(y,{modelValue:t.certStandardForm.validityPeriod,"onUpdate:modelValue":r[9]||(r[9]=n=>t.certStandardForm.validityPeriod=n),modelModifiers:{number:!0},type:"number",placeholder:"请输入有效期"},null,8,["modelValue"])]),_:1}),a(u,{label:"认证标准",prop:"certStandard"},{default:l(()=>[a(y,{modelValue:t.certStandardForm.certStandard,"onUpdate:modelValue":r[10]||(r[10]=n=>t.certStandardForm.certStandard=n),type:"textarea",rows:5,placeholder:"请输入认证标准详情"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])}const ge=H(Z,[["render",oe],["__scopeId","data-v-49af97af"]]);export{ge as default};
