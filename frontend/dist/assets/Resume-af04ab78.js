import{_ as q,m as F,U as L,r as E,D as A,o as G,i as _,V as K,K as H,j as u,k as m,B as O,w as n,I as B,q as o,y as p,n as s,F as g,t as V,z as i,x as y}from"./index-94722956.js";import{r as Y}from"./request-95526739.js";const J={name:"ResumeManage",components:{Medal:F,Refresh:L},setup(){const x=E(!1),l=E(null),b=E(!1),t=E(!1),w=E(!1),I=E([]),a=A({basicInfo:{name:"",phone:"",email:"",location:"",careerObjective:""},education:[],workExperience:[],projectExperience:[],skills:[],certificates:[],isPublic:!1}),j={"basicInfo.name":[{required:!0,message:"请输入姓名",trigger:"blur"}],"basicInfo.phone":[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号",trigger:"blur"}],"basicInfo.email":[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}]},U=async()=>{t.value=!0;try{const r=await Y.get("/certification/passed");if(r.data&&r.data.length>0){const c=a.certificates.map(e=>e.name),C=r.data.filter(e=>!c.includes(e.certificationName));C.length>0?(I.value=C.map(e=>({id:e.id,name:e.certificationName,level:e.level,date:e.passDate||new Date().toISOString().split("T")[0]})),w.value=!0,p.success(`发现 ${C.length} 项新认证可以同步`)):p.info("您的简历已包含所有认证信息")}else p.info("暂无已通过的认证")}catch(r){console.error("检查认证失败:",r),I.value=[{id:1,name:"服装设计师",level:"中级",date:"2024-12-15"},{id:2,name:"服装打版师",level:"初级",date:"2024-11-20"}],w.value=!0}finally{t.value=!1}},M=async()=>{b.value=!0;try{const r=I.value.map(c=>({name:`${c.name} (${c.level})`,date:c.date}));a.certificates=[...a.certificates,...r],await Y.put("/resume",{basicInfo:a.basicInfo,education:a.education,workExperience:a.workExperience,projectExperience:a.projectExperience,skills:a.skills,certificates:a.certificates,isPublic:a.isPublic}),w.value=!1,I.value=[],p.success("认证信息已同步到简历")}catch(r){console.error("同步认证失败:",r),p.error("同步失败，请重试")}finally{b.value=!1}},h=()=>{w.value=!1},D=async()=>{var r;b.value=!0;try{const c=await Y.get("/resume/current");c.data&&(Object.assign(a.basicInfo,c.data.basicInfo||{}),a.education=c.data.education||[],a.workExperience=c.data.workExperience||[],a.projectExperience=c.data.projectExperience||[],a.skills=c.data.skills||[],a.certificates=c.data.certificates||[],a.isPublic=c.data.isPublic||!1),U()}catch(c){console.error("加载简历失败:",c),((r=c.response)==null?void 0:r.status)!==404&&p.error("加载简历失败，请刷新重试")}finally{b.value=!1}},T=()=>{x.value=!0},S=async()=>{if(!l.value){p.error("表单未加载");return}l.value.validate(async r=>{if(!r)return p.error("请填写必填项"),!1;b.value=!0;try{await Y.put("/resume",{basicInfo:a.basicInfo,education:a.education,workExperience:a.workExperience,projectExperience:a.projectExperience,skills:a.skills,certificates:a.certificates,isPublic:a.isPublic}),x.value=!1,p.success("简历保存成功")}catch(c){console.error("保存简历失败:",c),p.error(c.message||"保存简历失败，请重试")}finally{b.value=!1}})},k=()=>{x.value=!1,D()},v=async()=>{b.value=!0;try{const r=localStorage.getItem("token"),c=await fetch("/api/resume/export",{method:"GET",headers:{Authorization:`Bearer ${r}`}});if(!c.ok)throw new Error("导出失败");const C=await c.blob(),e=window.URL.createObjectURL(C),d=document.createElement("a");d.href=e,d.download=`简历_${a.basicInfo.name||"未命名"}_${new Date().getTime()}.pdf`,document.body.appendChild(d),d.click(),document.body.removeChild(d),window.URL.revokeObjectURL(e),p.success("简历导出成功")}catch(r){console.error("导出简历失败:",r),p.error("导出简历失败，请重试")}finally{b.value=!1}},R=async()=>{b.value=!0;try{await Y.put("/resume/public",{isPublic:a.isPublic}),p.success(a.isPublic?"简历已设为公开":"简历已设为私有")}catch(r){console.error("设置简历公开状态失败:",r),a.isPublic=!a.isPublic,p.error("设置失败，请重试")}finally{b.value=!1}};return G(()=>{D()}),{isEditing:x,loading:b,resume:a,resumeForm:l,resumeRules:j,loadResume:D,editResume:T,saveResume:S,cancelEdit:k,exportResume:v,togglePublic:R,addEducation:()=>{a.education.push({school:"",major:"",degree:"",startDate:"",endDate:"",description:""})},removeEducation:r=>{a.education.length>1?a.education.splice(r,1):p.warning("至少保留一条教育经历")},checkingCerts:t,showCertSyncTip:w,newCertifications:I,checkCertifications:U,syncCertifications:M,dismissCertSyncTip:h}}},Q={class:"resume-container"},W={class:"cert-sync-content"},X={class:"cert-list"},Z={class:"cert-sync-actions"},$={class:"card-header"},ee={class:"header-actions"},se={key:1,class:"resume-preview"},le={class:"resume-header"},te={class:"contact-info"},oe={class:"career-objective"},ae={class:"resume-section"},ne={class:"edu-header"},ie={class:"school"},re={class:"period"},ce={class:"edu-details"},de={class:"major"},ue={class:"degree"},me={class:"edu-desc"},fe={class:"resume-section"},_e={class:"work-header"},pe={class:"company"},ve={class:"period"},be={class:"work-details"},he={class:"position"},ye={class:"work-responsibilities"},ke={class:"resume-section"},ge={class:"project-header"},Ve={class:"project-name"},Ce={class:"period"},we={class:"project-details"},Ie={class:"role"},Ee={class:"project-desc"},xe={class:"project-achievements"},je={class:"resume-section"},Ue={class:"skills-certificates"},De={class:"skills"},Re={class:"skill-tags"},Pe={class:"certificates"},Ye={class:"cert-name"},Me={class:"cert-date"},Te={class:"resume-actions"},Se={key:2,class:"resume-edit"},ze={class:"section-header"},Oe={class:"group-header"},Ne={class:"date-range"},Be={class:"form-actions"};function qe(x,l,b,t,w,I){const a=_("Medal"),j=_("el-icon"),U=_("el-tag"),M=_("Refresh"),h=_("el-button"),D=_("el-alert"),T=_("el-empty"),S=_("el-switch"),k=_("el-input"),v=_("el-form-item"),R=_("el-card"),P=_("el-option"),N=_("el-select"),r=_("el-date-picker"),c=_("el-form"),C=K("loading");return H((u(),m("div",Q,[t.showCertSyncTip?(u(),O(D,{key:0,title:"发现新的认证信息",type:"success",description:`您有 ${t.newCertifications.length} 项新认证可以同步到简历中`,"show-icon":"",closable:!0,onClose:t.dismissCertSyncTip,class:"cert-sync-alert"},{default:n(()=>[s("div",W,[s("div",X,[(u(!0),m(g,null,V(t.newCertifications,e=>(u(),m("div",{key:e.id,class:"cert-item-tip"},[o(j,null,{default:n(()=>[o(a)]),_:1}),s("span",null,i(e.name)+" - "+i(e.level),1),o(U,{size:"small",type:"success"},{default:n(()=>[y(i(e.date),1)]),_:2},1024)]))),128))]),s("div",Z,[o(h,{type:"primary",size:"small",onClick:t.syncCertifications},{default:n(()=>[o(j,null,{default:n(()=>[o(M)]),_:1}),l[6]||(l[6]=y(" 立即同步 ",-1))]),_:1},8,["onClick"]),o(h,{size:"small",onClick:t.dismissCertSyncTip},{default:n(()=>[...l[7]||(l[7]=[y("稍后处理",-1)])]),_:1},8,["onClick"])])])]),_:1},8,["description","onClose"])):B("",!0),o(R,{shadow:"hover"},{header:n(()=>[s("div",$,[l[10]||(l[10]=s("h2",null,"简历管理",-1)),s("div",ee,[o(h,{type:"success",onClick:t.checkCertifications,loading:t.checkingCerts},{default:n(()=>[o(j,null,{default:n(()=>[o(a)]),_:1}),l[8]||(l[8]=y(" 检查认证更新 ",-1))]),_:1},8,["onClick","loading"]),o(h,{type:"primary",onClick:t.editResume,disabled:t.loading},{default:n(()=>[...l[9]||(l[9]=[y("编辑简历",-1)])]),_:1},8,["onClick","disabled"])])])]),default:n(()=>[!t.loading&&!t.resume.basicInfo.name&&!t.isEditing?(u(),O(T,{key:0,description:"还没有简历，点击上方编辑简历按钮创建您的简历"},{default:n(()=>[o(h,{type:"primary",onClick:t.editResume},{default:n(()=>[...l[11]||(l[11]=[y("立即创建",-1)])]),_:1},8,["onClick"])]),_:1})):B("",!0),!t.isEditing&&t.resume.basicInfo.name?(u(),m("div",se,[s("div",le,[s("h1",null,i(t.resume.basicInfo.name),1),s("p",te,i(t.resume.basicInfo.phone)+" | "+i(t.resume.basicInfo.email)+" | "+i(t.resume.basicInfo.location),1),s("p",oe,i(t.resume.basicInfo.careerObjective),1)]),s("div",ae,[l[12]||(l[12]=s("h3",null,"教育背景",-1)),(u(!0),m(g,null,V(t.resume.education,(e,d)=>(u(),m("div",{key:d,class:"edu-item"},[s("div",ne,[s("span",ie,i(e.school),1),s("span",re,i(e.startDate)+" - "+i(e.endDate),1)]),s("div",ce,[s("span",de,i(e.major),1),s("span",ue,i(e.degree),1)]),s("p",me,i(e.description),1)]))),128))]),s("div",fe,[l[13]||(l[13]=s("h3",null,"工作经历",-1)),(u(!0),m(g,null,V(t.resume.workExperience,(e,d)=>(u(),m("div",{key:d,class:"work-item"},[s("div",_e,[s("span",pe,i(e.company),1),s("span",ve,i(e.startDate)+" - "+i(e.endDate),1)]),s("div",be,[s("span",he,i(e.position),1)]),s("ul",ye,[(u(!0),m(g,null,V(e.responsibilities,(f,z)=>(u(),m("li",{key:z},i(f),1))),128))])]))),128))]),s("div",ke,[l[14]||(l[14]=s("h3",null,"项目经验",-1)),(u(!0),m(g,null,V(t.resume.projectExperience,(e,d)=>(u(),m("div",{key:d,class:"project-item"},[s("div",ge,[s("span",Ve,i(e.name),1),s("span",Ce,i(e.startDate)+" - "+i(e.endDate),1)]),s("div",we,[s("span",Ie,i(e.role),1)]),s("p",Ee,i(e.description),1),s("ul",xe,[(u(!0),m(g,null,V(e.achievements,(f,z)=>(u(),m("li",{key:z},i(f),1))),128))])]))),128))]),s("div",je,[l[17]||(l[17]=s("h3",null,"技能证书",-1)),s("div",Ue,[s("div",De,[l[15]||(l[15]=s("h4",null,"专业技能",-1)),s("div",Re,[(u(!0),m(g,null,V(t.resume.skills,(e,d)=>(u(),O(U,{key:d,size:"small",type:"info"},{default:n(()=>[y(i(e),1)]),_:2},1024))),128))])]),s("div",Pe,[l[16]||(l[16]=s("h4",null,"认证证书",-1)),(u(!0),m(g,null,V(t.resume.certificates,(e,d)=>(u(),m("div",{key:d,class:"cert-item"},[s("span",Ye,i(e.name),1),s("span",Me,i(e.date),1)]))),128))])])]),s("div",Te,[o(h,{type:"success",onClick:t.exportResume},{default:n(()=>[...l[18]||(l[18]=[y("导出PDF",-1)])]),_:1},8,["onClick"]),o(S,{modelValue:t.resume.isPublic,"onUpdate:modelValue":l[0]||(l[0]=e=>t.resume.isPublic=e),"active-text":"公开","inactive-text":"私有",onChange:t.togglePublic},null,8,["modelValue","onChange"])])])):(u(),m("div",Se,[o(c,{ref:"resumeForm",model:t.resume,"label-width":"100px",rules:t.resumeRules},{default:n(()=>[o(R,{shadow:"hover",class:"edit-section"},{header:n(()=>[...l[19]||(l[19]=[s("h3",null,"基本信息",-1)])]),default:n(()=>[o(v,{label:"姓名",prop:"basicInfo.name"},{default:n(()=>[o(k,{modelValue:t.resume.basicInfo.name,"onUpdate:modelValue":l[1]||(l[1]=e=>t.resume.basicInfo.name=e)},null,8,["modelValue"])]),_:1}),o(v,{label:"手机号",prop:"basicInfo.phone"},{default:n(()=>[o(k,{modelValue:t.resume.basicInfo.phone,"onUpdate:modelValue":l[2]||(l[2]=e=>t.resume.basicInfo.phone=e)},null,8,["modelValue"])]),_:1}),o(v,{label:"邮箱",prop:"basicInfo.email"},{default:n(()=>[o(k,{modelValue:t.resume.basicInfo.email,"onUpdate:modelValue":l[3]||(l[3]=e=>t.resume.basicInfo.email=e)},null,8,["modelValue"])]),_:1}),o(v,{label:"所在地"},{default:n(()=>[o(k,{modelValue:t.resume.basicInfo.location,"onUpdate:modelValue":l[4]||(l[4]=e=>t.resume.basicInfo.location=e)},null,8,["modelValue"])]),_:1}),o(v,{label:"职业目标"},{default:n(()=>[o(k,{modelValue:t.resume.basicInfo.careerObjective,"onUpdate:modelValue":l[5]||(l[5]=e=>t.resume.basicInfo.careerObjective=e),type:"textarea",rows:3},null,8,["modelValue"])]),_:1})]),_:1}),o(R,{shadow:"hover",class:"edit-section"},{header:n(()=>[s("div",ze,[l[21]||(l[21]=s("h3",null,"教育背景",-1)),o(h,{type:"primary",size:"small",onClick:t.addEducation},{default:n(()=>[...l[20]||(l[20]=[y("添加教育经历",-1)])]),_:1},8,["onClick"])])]),default:n(()=>[(u(!0),m(g,null,V(t.resume.education,(e,d)=>(u(),m("div",{key:d,class:"form-item-group"},[s("div",Oe,[s("span",null,"教育经历 "+i(d+1),1),o(h,{type:"danger",size:"small",onClick:f=>t.removeEducation(d)},{default:n(()=>[...l[22]||(l[22]=[y("删除",-1)])]),_:1},8,["onClick"])]),o(v,{label:"学校 "+(d+1)},{default:n(()=>[o(k,{modelValue:e.school,"onUpdate:modelValue":f=>e.school=f},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]),o(v,{label:"专业 "+(d+1)},{default:n(()=>[o(k,{modelValue:e.major,"onUpdate:modelValue":f=>e.major=f},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]),o(v,{label:"学历 "+(d+1)},{default:n(()=>[o(N,{modelValue:e.degree,"onUpdate:modelValue":f=>e.degree=f,placeholder:"请选择学历"},{default:n(()=>[o(P,{label:"专科",value:"专科"}),o(P,{label:"本科",value:"本科"}),o(P,{label:"硕士",value:"硕士"}),o(P,{label:"博士",value:"博士"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]),s("div",Ne,[o(v,{label:"开始时间 "+(d+1)},{default:n(()=>[o(r,{modelValue:e.startDate,"onUpdate:modelValue":f=>e.startDate=f,type:"date",format:"YYYY-MM","value-format":"YYYY-MM"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]),o(v,{label:"结束时间 "+(d+1)},{default:n(()=>[o(r,{modelValue:e.endDate,"onUpdate:modelValue":f=>e.endDate=f,type:"date",format:"YYYY-MM","value-format":"YYYY-MM"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])]),o(v,{label:"描述 "+(d+1)},{default:n(()=>[o(k,{modelValue:e.description,"onUpdate:modelValue":f=>e.description=f,type:"textarea",rows:2},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])]))),128))]),_:1}),s("div",Be,[o(h,{type:"primary",onClick:t.saveResume},{default:n(()=>[...l[23]||(l[23]=[y("保存简历",-1)])]),_:1},8,["onClick"]),o(h,{onClick:t.cancelEdit},{default:n(()=>[...l[24]||(l[24]=[y("取消",-1)])]),_:1},8,["onClick"])])]),_:1},8,["model","rules"])]))]),_:1})])),[[C,t.loading]])}const Ae=q(J,[["render",qe],["__scopeId","data-v-5e761559"]]);export{Ae as default};
