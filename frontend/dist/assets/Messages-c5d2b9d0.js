import{_ as ne,g as oe,r as _,h as G,o as ie,j as p,k as f,n as y,q as o,t as a,w as s,I as A,Q as w,as as re,D as C,E as P,G as v,R as m,y as u,F as de,v as ue,U as ce,H as fe,J as ve,V as j,a7 as _e,a2 as pe,ad as ge,at as ye,m as H,aq as J,b as Q,au as K,c as me}from"./index-3d929bd0.js";import{r as V}from"./request-9595d616.js";const he={class:"messages-container"},be={class:"page-header"},ke={class:"header-left"},we={class:"subtitle"},Ce={class:"header-actions"},Me={class:"message-tabs"},Re={class:"messages-list"},Te=["onClick"],xe={class:"message-content"},Ie={class:"message-header"},Ve={class:"message-title"},ze={class:"message-time"},De={class:"message-summary"},$e={key:0,class:"message-footer"},Ae={class:"message-actions"},je={key:0,class:"load-more"},Ue={key:0,class:"message-detail"},Ne={class:"detail-meta"},Be={class:"detail-time"},Ee={class:"detail-content"},Se={key:0,class:"detail-action"},qe={__name:"Messages",setup(Fe){const z=oe(),R=_("all"),d=_([]),T=_(!1),g=_(!0),D=_(1),U=_(10),h=_(!1),c=_(null),x=G(()=>d.value.filter(t=>!t.isRead).length),N=G(()=>R.value==="all"?d.value:d.value.filter(t=>t.type===R.value)),O=t=>({certification:H,interview:J,job:Q,system:K})[t]||_e,B=t=>({certification:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",interview:"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)",job:"linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)",system:"linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)"})[t]||"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",W=t=>({certification:"认证通知",interview:"面试邀请",job:"职位推荐",system:"系统通知"})[t]||"通知",E=t=>{if(!t)return"";const e=new Date(t),n=new Date-e;return n<6e4?"刚刚":n<36e5?`${Math.floor(n/6e4)} 分钟前`:n<864e5?`${Math.floor(n/36e5)} 小时前`:e.toLocaleDateString("zh-CN")},X=t=>{c.value=t,h.value=!0,t.isRead||S(t)},I=()=>{const t=pe("1");return{userId:Number(t.userId||0),userType:1}},S=async t=>{try{const{userId:e}=I();if(!e)return;await V({url:`/notification/read/${t.id}`,method:"put",params:{userId:e}})}catch{}t.isRead=!0},Y=async()=>{try{const{userId:t,userType:e}=I();if(!t||!e)return;await V({url:"/notification/read-all",method:"put",params:{userId:t,userType:e}})}catch{}d.value.forEach(t=>t.isRead=!0),C.success("已全部标记为已读")},Z=t=>{P.confirm("确定删除这条消息吗？","删除确认",{type:"warning"}).then(async()=>{try{const{userId:i}=I();if(!i)return;await V.delete(`/notification/${t.id}`,{params:{userId:i}})}catch{}const e=d.value.findIndex(i=>i.id===t.id);e>-1&&d.value.splice(e,1),C.success("删除成功")}).catch(()=>{})},ee=()=>{P.confirm("确定清空所有消息吗？此操作不可撤销","清空确认",{type:"warning"}).then(async()=>{d.value=[],C.success("已清空所有消息")}).catch(()=>{})},te=t=>({certification:"/personal/certification",interview:"/personal/applications",job:"/personal/job",system:"/personal/messages"})[t]||"/personal/messages",q=t=>{const e=((t==null?void 0:t.actionUrl)||"").trim();if(!e){C.info("该消息暂未配置跳转链接");return}if(/^https?:\/\//i.test(e)){window.open(e,"_blank"),h.value=!1;return}const i=z.resolve(e);if(!i.matched||i.matched.length===0){const n=te(t==null?void 0:t.type);C.warning("跳转地址不存在，已为您跳转到相关页面"),z.push(n),h.value=!1;return}z.push(e),h.value=!1},ae=async()=>{T.value||!g.value||(D.value+=1,await F(!0))},F=async(t=!1)=>{const{userId:e,userType:i}=I();if(!e||!i){d.value=[],g.value=!1;return}T.value=!0;try{const r=(await V.get("/notification/list",{params:{userId:e,userType:i,current:D.value,size:U.value}})).data||{},M=(Array.isArray(r)?r:r.records||r.list||[]).map(k=>({...k,isRead:k.isRead===1||k.isRead===!0,type:k.type||"system"}));d.value=t?[...d.value,...M]:M,r.pages!==void 0?g.value=D.value<r.pages:r.total!==void 0?g.value=d.value.length<r.total:g.value=M.length===U.value}catch{t||(d.value=[]),g.value=!1,C.error("加载消息失败")}finally{T.value=!1}};return ie(()=>{F()}),(t,e)=>{var L;const i=p("el-badge"),n=p("el-icon"),r=p("el-button"),b=p("el-radio-button"),M=p("el-radio-group"),k=p("el-empty"),se=p("el-tag"),le=p("el-dialog");return f(),y("div",he,[o("div",be,[o("div",ke,[e[3]||(e[3]=o("h1",null,"消息中心",-1)),a(i,{value:x.value,hidden:x.value===0,class:"unread-badge"},{default:s(()=>[o("span",we,"您有 "+v(x.value)+" 条未读消息",1)]),_:1},8,["value","hidden"])]),o("div",Ce,[a(r,{onClick:Y,disabled:x.value===0},{default:s(()=>[a(n,null,{default:s(()=>[a(m(ge))]),_:1}),e[4]||(e[4]=u(" 全部已读 ",-1))]),_:1},8,["disabled"]),a(r,{type:"danger",plain:"",onClick:ee,disabled:d.value.length===0},{default:s(()=>[a(n,null,{default:s(()=>[a(m(ye))]),_:1}),e[5]||(e[5]=u(" 清空消息 ",-1))]),_:1},8,["disabled"])])]),o("div",Me,[a(M,{modelValue:R.value,"onUpdate:modelValue":e[0]||(e[0]=l=>R.value=l),size:"large"},{default:s(()=>[a(b,{label:"all"},{default:s(()=>[e[6]||(e[6]=u(" 全部消息 ",-1)),a(i,{value:d.value.length,hidden:d.value.length===0},null,8,["value","hidden"])]),_:1}),a(b,{label:"certification"},{default:s(()=>[a(n,null,{default:s(()=>[a(m(H))]),_:1}),e[7]||(e[7]=u(" 认证通知 ",-1))]),_:1}),a(b,{label:"interview"},{default:s(()=>[a(n,null,{default:s(()=>[a(m(J))]),_:1}),e[8]||(e[8]=u(" 面试邀请 ",-1))]),_:1}),a(b,{label:"job"},{default:s(()=>[a(n,null,{default:s(()=>[a(m(Q))]),_:1}),e[9]||(e[9]=u(" 职位推荐 ",-1))]),_:1}),a(b,{label:"system"},{default:s(()=>[a(n,null,{default:s(()=>[a(m(K))]),_:1}),e[10]||(e[10]=u(" 系统通知 ",-1))]),_:1})]),_:1},8,["modelValue"])]),o("div",Re,[N.value.length===0?(f(),A(k,{key:0,description:"暂无消息"})):w("",!0),a(re,{name:"message",tag:"div"},{default:s(()=>[(f(!0),y(de,null,ue(N.value,l=>(f(),y("div",{key:l.id,class:ce(["message-card",{unread:!l.isRead}]),onClick:$=>X(l)},[o("div",{class:"message-icon",style:fe({background:B(l.type)})},[a(n,null,{default:s(()=>[(f(),A(ve(O(l.type))))]),_:2},1024)],4),o("div",xe,[o("div",Ie,[o("h3",Ve,v(l.title),1),o("span",ze,v(E(l.createTime)),1)]),o("p",De,v(l.content),1),l.actionUrl?(f(),y("div",$e,[a(r,{type:"primary",link:"",size:"small",onClick:j($=>q(l),["stop"])},{default:s(()=>[u(v(l.actionText||"查看详情")+" ",1),a(n,null,{default:s(()=>[a(m(me))]),_:1})]),_:2},1032,["onClick"])])):w("",!0)]),o("div",Ae,[l.isRead?w("",!0):(f(),A(r,{key:0,type:"primary",link:"",onClick:j($=>S(l),["stop"])},{default:s(()=>[...e[11]||(e[11]=[u(" 标记已读 ",-1)])]),_:1},8,["onClick"])),a(r,{type:"danger",link:"",onClick:j($=>Z(l),["stop"])},{default:s(()=>[...e[12]||(e[12]=[u(" 删除 ",-1)])]),_:1},8,["onClick"])])],10,Te))),128))]),_:1})]),g.value?(f(),y("div",je,[a(r,{onClick:ae,loading:T.value},{default:s(()=>[...e[13]||(e[13]=[u("加载更多",-1)])]),_:1},8,["loading"])])):w("",!0),a(le,{modelValue:h.value,"onUpdate:modelValue":e[2]||(e[2]=l=>h.value=l),title:(L=c.value)==null?void 0:L.title,width:"600px"},{default:s(()=>[c.value?(f(),y("div",Ue,[o("div",Ne,[a(se,{color:B(c.value.type),effect:"dark",size:"small"},{default:s(()=>[u(v(W(c.value.type)),1)]),_:1},8,["color"]),o("span",Be,v(E(c.value.createTime)),1)]),o("div",Ee,v(c.value.content),1),c.value.actionUrl?(f(),y("div",Se,[a(r,{type:"primary",onClick:e[1]||(e[1]=l=>q(c.value))},{default:s(()=>[u(v(c.value.actionText||"查看详情"),1)]),_:1})])):w("",!0)])):w("",!0)]),_:1},8,["modelValue","title"])])}}},Pe=ne(qe,[["__scopeId","data-v-5b537f53"]]);export{Pe as default};
