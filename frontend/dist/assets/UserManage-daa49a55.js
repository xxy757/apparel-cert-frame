import{_ as dt,K as O,r as h,o as ut,D as v,L as pt,M as ct,j as m,k as L,n as Te,q as o,t,w as a,G as u,av as xe,R as w,ai as mt,y as i,I as q,Q as Y,E as H,u as ft,aK as vt,Y as yt,W as _t,ar as Ce,aL as Ue,ah as Ne,a3 as bt,am as wt,aA as gt,ak as ht,a6 as kt,$ as Vt,af as Tt,at as xt,e as Ct}from"./index-3d929bd0.js";import{r as y}from"./request-9595d616.js";import{i as pe}from"./index-18acf776.js";const Ut={class:"user-manage-container"},Nt={class:"stats-section"},St={class:"stat-icon total"},Pt={class:"stat-info"},zt={class:"stat-num"},Et={class:"stat-card"},Rt={class:"stat-icon personal"},$t={class:"stat-info"},Dt={class:"stat-num"},Lt={class:"stat-card"},At={class:"stat-icon enterprise"},Bt={class:"stat-info"},It={class:"stat-num"},qt={class:"stat-card"},Mt={class:"stat-icon active"},Ft={class:"stat-info"},Ot={class:"stat-num"},Yt={class:"stat-card"},jt={class:"stat-icon disabled"},Ht={class:"stat-info"},Kt={class:"stat-num"},Gt={class:"statistics-content"},Wt={class:"chart-container"},Qt={class:"chart-container"},Jt={class:"chart-container"},Xt={class:"statistics-summary"},Zt={class:"summary-item"},ea={class:"summary-value"},ta={class:"summary-item"},aa={class:"summary-value"},sa={class:"summary-item"},la={class:"summary-value"},na={class:"summary-item"},oa={class:"summary-value"},ra={class:"filter-section"},ia={class:"filter-row"},da={class:"action-row"},ua={class:"user-info-cell"},pa={class:"user-details"},ca={class:"username"},ma={class:"email"},fa={class:"pagination-container"},va={key:0,class:"user-detail-content"},ya={class:"detail-header"},_a={class:"detail-basic"},ba={class:"detail-actions"},wa={__name:"UserManage",setup(ga){const k=O({total:0,personal:0,enterprise:0,admin:0,active:0,disabled:0}),_=O({keyword:"",userType:"",status:"",dateRange:[]}),ce=h(null),M=h(!1),z=h(!1),d=O({id:null,username:"",name:"",password:"",email:"",phone:"",companyName:"",contactPerson:"",contactPhone:"",address:"",userType:"personal",status:1,remark:""}),Se={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"长度在 3 到 20 个字符",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"长度在 6 到 20 个字符",trigger:"blur"}],name:[{required:!0,message:"请输入姓名",trigger:"blur"},{min:2,max:20,message:"长度在 2 到 20 个字符",trigger:"blur"}],companyName:[{required:!0,message:"请输入企业名称",trigger:"blur"},{min:2,max:100,message:"长度在 2 到 100 个字符",trigger:"blur"}],contactPerson:[{required:!0,message:"请输入联系人姓名",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}],phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号码",trigger:"blur"}],contactPhone:[{required:!0,message:"请输入联系人电话",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号码",trigger:"blur"}],userType:[{required:!0,message:"请选择用户类型",trigger:"change"}]},Z=h([]),C=h([]),B=h(1),K=h(10),ee=h(0),G=h(!1),p=h(null),W=h(!1),te=h([]),ae=h(!1),se=h("trend"),le=h(null),ne=h(null),oe=h(null),S=O({monthlyNew:0,dailyActive:0,retentionRate:0,certificationRate:0}),V=O({labels:[],personal:[],enterprise:[],total:[]}),g=O({todayNewPersonal:0,todayNewEnterprise:0,weekNewPersonal:0,weekNewEnterprise:0,monthNewPersonal:0,monthNewEnterprise:0});let R=null,$=null,D=null;ut(()=>{I(),A()});const I=async()=>{try{const s={personal:"/admin/user/personal",enterprise:"/admin/user/enterprise",admin:"/admin/user/admin"},e=_.userType||"personal",n=s[e]||"/admin/user/personal",r={page:B.value,size:K.value,keyword:_.keyword};_.status!==""&&_.status!==null&&_.status!==void 0&&(r.status=Number(_.status));const c=await y.get(n,{params:r}),U=c.data.records||[];Z.value=U.map(b=>Ye(b,e)),ee.value=c.data.total||0}catch(s){console.error("加载用户失败:",s),v.error("加载用户失败"),Z.value=[],ee.value=0}},A=async()=>{try{const e=(await y.get("/admin/user/statistics")).data||{},n=e.totalPersonalUsers||0,r=e.totalEnterpriseUsers||0,c=e.totalAdminUsers||0,U=e.activePersonalUsers||0,b=e.activeEnterpriseUsers||0,T=e.activeAdminUsers||0;k.personal=n,k.enterprise=r,k.admin=c,k.total=n+r+c,k.active=U+b+T,k.disabled=Math.max(k.total-k.active,0)}catch(s){console.error("加载用户统计失败:",s),v.error("加载用户统计失败")}},me=()=>{B.value=1,I()},Pe=()=>{_.keyword="",_.userType="",_.status="",_.dateRange=[],B.value=1,I()},re=s=>({personal:"个人用户",enterprise:"企业用户",admin:"管理员"})[s]||"未知",fe=s=>({personal:"info",enterprise:"success",admin:"warning"})[s]||"info",ze=s=>{C.value=s},Ee=async s=>{const e=s.status,n=e===1?0:1,r=e===1?"启用":"禁用";try{await _e(s,e),v.success(`已${r}用户：${s.username}`),A()}catch{s.status=n,v.error("操作失败")}},Re=()=>{z.value=!1,Object.assign(d,{id:null,username:"",name:"",password:"",email:"",phone:"",companyName:"",contactPerson:"",contactPhone:"",address:"",userType:"personal",status:1,remark:""}),M.value=!0},ve=s=>{z.value=!0,Object.assign(d,{...s}),M.value=!0,G.value=!1},$e=()=>{var s;(s=ce.value)==null||s.validate(async e=>{if(e)try{const n={...d};z.value&&delete n.password,n.userType==="personal"?z.value?await y.put("/admin/user/personal",n):await y.post("/admin/user/personal",n):n.userType==="enterprise"?z.value?await y.put("/admin/user/enterprise",n):await y.post("/admin/user/enterprise",n):z.value?await y.put("/admin/user/admin",n):await y.post("/admin/user/admin",n),v.success(z.value?"用户信息已更新":"用户添加成功"),M.value=!1,I(),A()}catch{v.error("操作失败")}})},De=s=>{p.value={...s},G.value=!0},Le=s=>{const e=s.status===1?0:1,n=e===1?"启用":"禁用";H.confirm(`确定要${n}用户 "${s.username}" 吗？`,"确认操作",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await _e(s,e),s.status=e,p.value&&(p.value.status=e),v.success(`已${n}用户`),A()}catch{v.error("操作失败")}}).catch(()=>{})},ye=s=>{H.confirm(`确定要重置用户 "${s.username}" 的密码吗？`,"重置密码",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await He(s),v.success("密码已重置为默认密码：123456")}catch{v.error("重置密码失败")}}).catch(()=>{})},Ae=async s=>{try{te.value=[],W.value=!0,v.info("当前暂未提供登录记录接口")}catch(e){console.error("加载登录记录失败:",e),v.error("加载登录记录失败"),te.value=[],W.value=!0}},Be=s=>{H.confirm(`确定要删除用户 "${s.username}" 吗？此操作不可恢复！`,"删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"error"}).then(async()=>{try{await Ke(s),v.success("用户已删除"),I(),A()}catch{v.error("删除失败")}}).catch(()=>{})},Ie=()=>{H.confirm(`确定要启用选中的 ${C.value.length} 个用户吗？`,"批量启用",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}).then(async()=>{try{await be(1),C.value.forEach(s=>{s.status=1}),v.success(`已启用 ${C.value.length} 个用户`),A()}catch{v.error("操作失败")}}).catch(()=>{})},qe=()=>{H.confirm(`确定要禁用选中的 ${C.value.length} 个用户吗？`,"批量禁用",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await be(0),C.value.forEach(s=>{s.status=0}),v.success(`已禁用 ${C.value.length} 个用户`),A()}catch{v.error("操作失败")}}).catch(()=>{})},Me=()=>{v.success(`正在导出 ${C.value.length} 个用户数据...`)},Fe=s=>{K.value=s,B.value=1,I()},Oe=s=>{B.value=s,I()},Ye=(s,e)=>({...s,userType:e,phone:s.phone||s.contactPhone,avatar:s.avatar||s.logo}),Q=s=>s.userType||_.userType||"personal",je=(s,e,n)=>s==="admin"?{url:n===1?"/admin/user/admin/unfreeze":"/admin/user/admin/freeze",params:{adminId:e}}:s==="enterprise"?{url:n===1?"/admin/user/enterprise/unfreeze":"/admin/user/enterprise/freeze",params:{userId:e}}:{url:n===1?"/admin/user/personal/unfreeze":"/admin/user/personal/freeze",params:{userId:e}},_e=async(s,e)=>{const n=Q(s),{url:r,params:c}=je(n,s.id,e);await y.put(r,null,{params:c})},He=async s=>{const e=Q(s),n="123456";if(e==="admin"){await y.put("/admin/user/admin/reset-password",null,{params:{adminId:s.id,newPassword:n}});return}if(e==="enterprise"){await y.put("/admin/user/enterprise/reset-password",null,{params:{userId:s.id,newPassword:n}});return}await y.put("/admin/user/personal/reset-password",null,{params:{userId:s.id,newPassword:n}})},Ke=async s=>{const e=Q(s);if(e==="admin"){await y.delete("/admin/user/admin",{params:{adminId:s.id}});return}if(e==="enterprise"){await y.delete("/admin/user/enterprise",{params:{userId:s.id}});return}await y.delete("/admin/user/personal",{params:{userId:s.id}})},be=async s=>{const e=Q(C.value[0]||{}),n=C.value.map(c=>c.id);if(n.length===0)return;if(e==="admin"){const c=s===1?"/admin/user/admin/batch-unfreeze":"/admin/user/admin/batch-freeze";await y.put(c,n);return}if(e==="enterprise"){const c=s===1?"/admin/user/enterprise/batch-unfreeze":"/admin/user/enterprise/batch-freeze";await y.put(c,n);return}const r=s===1?"/admin/user/personal/batch-unfreeze":"/admin/user/personal/batch-freeze";await y.put(r,n)},we=(s=7)=>{const e=[],n=new Date;n.setHours(0,0,0,0);for(let r=s-1;r>=0;r--){const c=new Date(n);c.setDate(n.getDate()-r);const U=String(c.getMonth()+1).padStart(2,"0"),b=String(c.getDate()).padStart(2,"0");e.push(`${U}-${b}`)}return e},ie=()=>{const s=we(7);V.labels=s,V.personal=s.map(()=>0),V.enterprise=s.map(()=>0),V.total=s.map(()=>0)},ge=()=>{S.dailyActive=0,S.retentionRate=0,S.certificationRate=0,g.todayNewPersonal=0,g.todayNewEnterprise=0,g.weekNewPersonal=0,g.weekNewEnterprise=0,g.monthNewPersonal=0,g.monthNewEnterprise=0},Ge=async()=>{ae.value=!0,await Promise.all([A(),Je()])},We=async()=>{await xe(),Qe(),setTimeout(()=>{J()},120)},Qe=()=>{Xe(),Ze(),et()},Je=async()=>{try{const[s,e]=await Promise.allSettled([y.get("/admin/user/statistics/trend"),y.get("/admin/user/statistics/activity")]);let n=!1;if(s.status==="fulfilled"){const r=s.value.data||{},c=r.personalTrend||[],U=r.enterpriseTrend||[];if(c.length===0&&U.length===0)ie();else{const b=c.map(f=>f.date),T=c.map(f=>Number(f.count)||0),F=U.map(f=>Number(f.count)||0),de=T.map((f,X)=>f+(F[X]||0));V.labels=b,V.personal=T,V.enterprise=F,V.total=de}S.monthlyNew=r.monthlyNew||0}else n=!0,ie();if(e.status==="fulfilled"){const r=e.value.data||{};S.dailyActive=r.dailyActive||0,S.retentionRate=r.retentionRate||0,S.certificationRate=r.certificationRate||0,g.todayNewPersonal=r.todayNewPersonal||0,g.todayNewEnterprise=r.todayNewEnterprise||0,g.weekNewPersonal=r.weekNewPersonal||0,g.weekNewEnterprise=r.weekNewEnterprise||0,g.monthNewPersonal=r.monthNewPersonal||0,g.monthNewEnterprise=r.monthNewEnterprise||0}else n=!0,ge();n&&v.warning("部分统计数据加载失败，已使用空数据展示")}catch(s){console.error("加载统计数据失败:",s),ie(),ge(),v.error("加载统计数据失败")}},Xe=()=>{if(!le.value)return;R||(R=pe(le.value));const s=V.labels.length?V.labels:we(7),n=[...V.total||[],...V.personal||[],...V.enterprise||[]].some(c=>Number(c)>0),r={tooltip:{trigger:"axis"},legend:{data:["总用户数","个人用户","企业用户"]},grid:{left:24,right:24,top:40,bottom:24,containLabel:!0},xAxis:{type:"category",data:s,boundaryGap:!1,axisLine:{lineStyle:{color:"#e5e7eb"}},axisLabel:{color:"#6b7280"}},yAxis:{type:"value",axisLine:{show:!1},axisTick:{show:!1},splitLine:{lineStyle:{color:"#f3f4f6"}},axisLabel:{color:"#6b7280"}},series:[{name:"总用户数",type:"line",data:V.total,smooth:!0,lineStyle:{width:3,color:"#6366f1"},areaStyle:{color:"rgba(99, 102, 241, 0.15)"},symbol:"circle",symbolSize:6},{name:"个人用户",type:"line",data:V.personal,smooth:!0,lineStyle:{width:2,color:"#10b981"},symbol:"circle",symbolSize:5},{name:"企业用户",type:"line",data:V.enterprise,smooth:!0,lineStyle:{width:2,color:"#f97316"},symbol:"circle",symbolSize:5}],graphic:n?[]:[{type:"text",left:"center",top:"middle",style:{text:"近7天暂无新增数据",fill:"#9ca3af",font:"14px sans-serif"}}]};R.setOption(r),R.resize()},Ze=()=>{if(!ne.value)return;$||($=pe(ne.value));const s={tooltip:{trigger:"item",formatter:"{b}: {c} ({d}%)"},legend:{bottom:0},series:[{type:"pie",radius:["35%","70%"],avoidLabelOverlap:!1,label:{show:!1},emphasis:{label:{show:!0,fontSize:14,fontWeight:600}},data:[{value:k.personal,name:"个人用户"},{value:k.enterprise,name:"企业用户"},{value:k.admin,name:"管理员"}]}]};$.setOption(s),$.resize()},et=()=>{if(!oe.value)return;D||(D=pe(oe.value));const s=[g.todayNewPersonal,g.weekNewPersonal,g.monthNewPersonal],e=[g.todayNewEnterprise,g.weekNewEnterprise,g.monthNewEnterprise],n=[...s,...e].some(c=>Number(c)>0),r={tooltip:{trigger:"axis"},legend:{data:["个人用户","企业用户"]},grid:{left:24,right:24,top:40,bottom:24,containLabel:!0},xAxis:{type:"category",data:["今日新增","本周新增","本月新增"],axisLine:{lineStyle:{color:"#e5e7eb"}},axisLabel:{color:"#6b7280"}},yAxis:{type:"value",axisLine:{show:!1},axisTick:{show:!1},splitLine:{lineStyle:{color:"#f3f4f6"}},axisLabel:{color:"#6b7280"}},series:[{name:"个人用户",type:"bar",stack:"total",data:s,itemStyle:{color:"#34d399"}},{name:"企业用户",type:"bar",stack:"total",data:e,itemStyle:{color:"#f97316"}}],graphic:n?[]:[{type:"text",left:"center",top:"middle",style:{text:"暂无活跃新增数据",fill:"#9ca3af",font:"14px sans-serif"}}]};D.setOption(r),D.resize()},J=()=>{R&&R.resize(),$&&$.resize(),D&&D.resize()};return pt(se,async()=>{await xe(),J()}),window.addEventListener("resize",J),ct(()=>{window.removeEventListener("resize",J),R&&R.dispose(),$&&$.dispose(),D&&D.dispose(),R=null,$=null,D=null}),(s,e)=>{const n=m("el-icon"),r=m("el-tab-pane"),c=m("el-tabs"),U=m("el-dialog"),b=m("el-input"),T=m("el-option"),F=m("el-select"),de=m("el-date-picker"),f=m("el-button"),X=m("el-card"),x=m("el-table-column"),he=m("el-avatar"),j=m("el-tag"),tt=m("el-switch"),ue=m("el-dropdown-item"),at=m("el-dropdown-menu"),st=m("el-dropdown"),ke=m("el-table"),lt=m("el-pagination"),N=m("el-form-item"),Ve=m("el-radio"),nt=m("el-radio-group"),ot=m("el-form"),rt=m("el-divider"),P=m("el-descriptions-item"),it=m("el-descriptions");return L(),Te("div",Ut,[e[54]||(e[54]=o("div",{class:"page-header"},[o("div",{class:"header-content"},[o("h1",null,"用户管理"),o("p",{class:"subtitle"},"管理平台所有用户，维护系统安全")])],-1)),o("div",Nt,[o("div",{class:"stat-card",onClick:Ge},[o("div",St,[t(n,null,{default:a(()=>[t(w(ft))]),_:1})]),o("div",Pt,[o("span",zt,u(k.total),1),e[27]||(e[27]=o("span",{class:"stat-label"},"总用户数",-1))]),t(n,{class:"stat-chart-icon"},{default:a(()=>[t(w(vt))]),_:1})]),o("div",Et,[o("div",Rt,[t(n,null,{default:a(()=>[t(w(yt))]),_:1})]),o("div",$t,[o("span",Dt,u(k.personal),1),e[28]||(e[28]=o("span",{class:"stat-label"},"个人用户",-1))])]),o("div",Lt,[o("div",At,[t(n,null,{default:a(()=>[t(w(_t))]),_:1})]),o("div",Bt,[o("span",It,u(k.enterprise),1),e[29]||(e[29]=o("span",{class:"stat-label"},"企业用户",-1))])]),o("div",qt,[o("div",Mt,[t(n,null,{default:a(()=>[t(w(Ce))]),_:1})]),o("div",Ft,[o("span",Ot,u(k.active),1),e[30]||(e[30]=o("span",{class:"stat-label"},"活跃用户",-1))])]),o("div",Yt,[o("div",jt,[t(n,null,{default:a(()=>[t(w(Ue))]),_:1})]),o("div",Ht,[o("span",Kt,u(k.disabled),1),e[31]||(e[31]=o("span",{class:"stat-label"},"已禁用",-1))])])]),t(U,{modelValue:ae.value,"onUpdate:modelValue":e[1]||(e[1]=l=>ae.value=l),title:"用户统计分析",width:"900px",class:"statistics-dialog",onOpened:We},{default:a(()=>[o("div",Gt,[t(c,{modelValue:se.value,"onUpdate:modelValue":e[0]||(e[0]=l=>se.value=l)},{default:a(()=>[t(r,{label:"用户增长趋势",name:"trend"},{default:a(()=>[o("div",Wt,[o("div",{ref_key:"trendChartRef",ref:le,class:"chart",style:{height:"350px"}},null,512)])]),_:1}),t(r,{label:"用户类型分布",name:"distribution"},{default:a(()=>[o("div",Qt,[o("div",{ref_key:"distributionChartRef",ref:ne,class:"chart",style:{height:"350px"}},null,512)])]),_:1}),t(r,{label:"活跃度分析",name:"activity"},{default:a(()=>[o("div",Jt,[o("div",{ref_key:"activityChartRef",ref:oe,class:"chart",style:{height:"350px"}},null,512)])]),_:1})]),_:1},8,["modelValue"]),o("div",Xt,[o("div",Zt,[e[32]||(e[32]=o("span",{class:"summary-label"},"本月新增用户",-1)),o("span",ea,u(S.monthlyNew),1)]),o("div",ta,[e[33]||(e[33]=o("span",{class:"summary-label"},"日均活跃用户",-1)),o("span",aa,u(S.dailyActive),1)]),o("div",sa,[e[34]||(e[34]=o("span",{class:"summary-label"},"用户留存率",-1)),o("span",la,u(S.retentionRate)+"%",1)]),o("div",na,[e[35]||(e[35]=o("span",{class:"summary-label"},"企业认证率",-1)),o("span",oa,u(S.certificationRate)+"%",1)])])])]),_:1},8,["modelValue"]),t(X,{shadow:"hover",class:"filter-card"},{default:a(()=>[o("div",ra,[o("div",ia,[t(b,{modelValue:_.keyword,"onUpdate:modelValue":e[2]||(e[2]=l=>_.keyword=l),placeholder:"搜索用户名、邮箱、手机号...",clearable:"",class:"search-input",onKeyup:mt(me,["enter"])},{prefix:a(()=>[t(n,null,{default:a(()=>[t(w(Ne))]),_:1})]),_:1},8,["modelValue"]),t(F,{modelValue:_.userType,"onUpdate:modelValue":e[3]||(e[3]=l=>_.userType=l),placeholder:"用户类型",clearable:""},{default:a(()=>[t(T,{label:"全部类型",value:""}),t(T,{label:"个人用户",value:"personal"}),t(T,{label:"企业用户",value:"enterprise"}),t(T,{label:"管理员",value:"admin"})]),_:1},8,["modelValue"]),t(F,{modelValue:_.status,"onUpdate:modelValue":e[4]||(e[4]=l=>_.status=l),placeholder:"用户状态",clearable:""},{default:a(()=>[t(T,{label:"全部状态",value:""}),t(T,{label:"正常",value:"1"}),t(T,{label:"已禁用",value:"0"})]),_:1},8,["modelValue"]),t(de,{modelValue:_.dateRange,"onUpdate:modelValue":e[5]||(e[5]=l=>_.dateRange=l),type:"daterange","range-separator":"至","start-placeholder":"注册开始日期","end-placeholder":"注册结束日期","value-format":"YYYY-MM-DD"},null,8,["modelValue"]),t(f,{type:"primary",onClick:me},{default:a(()=>[t(n,null,{default:a(()=>[t(w(Ne))]),_:1}),e[36]||(e[36]=i(" 搜索 ",-1))]),_:1}),t(f,{onClick:Pe},{default:a(()=>[t(n,null,{default:a(()=>[t(w(bt))]),_:1}),e[37]||(e[37]=i(" 重置 ",-1))]),_:1})]),o("div",da,[t(f,{type:"primary",onClick:Re},{default:a(()=>[t(n,null,{default:a(()=>[t(w(wt))]),_:1}),e[38]||(e[38]=i(" 添加用户 ",-1))]),_:1}),t(f,{type:"success",disabled:C.value.length===0,onClick:Ie},{default:a(()=>[t(n,null,{default:a(()=>[t(w(Ce))]),_:1}),e[39]||(e[39]=i(" 批量启用 ",-1))]),_:1},8,["disabled"]),t(f,{type:"danger",disabled:C.value.length===0,onClick:qe},{default:a(()=>[t(n,null,{default:a(()=>[t(w(Ue))]),_:1}),e[40]||(e[40]=i(" 批量禁用 ",-1))]),_:1},8,["disabled"]),t(f,{disabled:C.value.length===0,onClick:Me},{default:a(()=>[t(n,null,{default:a(()=>[t(w(gt))]),_:1}),e[41]||(e[41]=i(" 导出选中 ",-1))]),_:1},8,["disabled"])])])]),_:1}),t(X,{shadow:"hover",class:"table-card"},{default:a(()=>[t(ke,{data:Z.value,style:{width:"100%"},onSelectionChange:ze,"row-key":"id"},{default:a(()=>[t(x,{type:"selection",width:"55"}),t(x,{prop:"id",label:"ID",width:"80"}),t(x,{label:"用户信息","min-width":"200"},{default:a(l=>[o("div",ua,[t(he,{size:40,src:l.row.avatar},{default:a(()=>{var E;return[i(u((E=l.row.username)==null?void 0:E.charAt(0)),1)]}),_:2},1032,["src"]),o("div",pa,[o("span",ca,u(l.row.username),1),o("span",ma,u(l.row.email),1)])])]),_:1}),t(x,{prop:"phone",label:"手机号",width:"130"}),t(x,{prop:"userType",label:"用户类型",width:"120"},{default:a(l=>[t(j,{type:fe(l.row.userType),effect:"light"},{default:a(()=>[i(u(re(l.row.userType)),1)]),_:2},1032,["type"])]),_:1}),t(x,{prop:"status",label:"状态",width:"100"},{default:a(l=>[t(tt,{modelValue:l.row.status,"onUpdate:modelValue":E=>l.row.status=E,"active-value":1,"inactive-value":0,onChange:E=>Ee(l.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),t(x,{prop:"lastLoginTime",label:"最后登录",width:"170"}),t(x,{prop:"createTime",label:"注册时间",width:"170"}),t(x,{label:"操作",width:"200",fixed:"right"},{default:a(l=>[t(f,{type:"primary",link:"",onClick:E=>De(l.row)},{default:a(()=>[t(n,null,{default:a(()=>[t(w(ht))]),_:1}),e[42]||(e[42]=i(" 详情 ",-1))]),_:1},8,["onClick"]),t(f,{type:"warning",link:"",onClick:E=>ve(l.row)},{default:a(()=>[t(n,null,{default:a(()=>[t(w(kt))]),_:1}),e[43]||(e[43]=i(" 编辑 ",-1))]),_:1},8,["onClick"]),t(st,{trigger:"click"},{dropdown:a(()=>[t(at,null,{default:a(()=>[t(ue,{onClick:E=>ye(l.row)},{default:a(()=>[t(n,null,{default:a(()=>[t(w(Vt))]),_:1}),e[45]||(e[45]=i(" 重置密码 ",-1))]),_:1},8,["onClick"]),t(ue,{onClick:E=>Ae(l.row)},{default:a(()=>[t(n,null,{default:a(()=>[t(w(Tt))]),_:1}),e[46]||(e[46]=i(" 登录记录 ",-1))]),_:1},8,["onClick"]),t(ue,{divided:"",onClick:E=>Be(l.row),style:{color:"#f56c6c"}},{default:a(()=>[t(n,null,{default:a(()=>[t(w(xt))]),_:1}),e[47]||(e[47]=i(" 删除用户 ",-1))]),_:1},8,["onClick"])]),_:2},1024)]),default:a(()=>[t(f,{type:"info",link:""},{default:a(()=>[e[44]||(e[44]=i(" 更多 ",-1)),t(n,null,{default:a(()=>[t(w(Ct))]),_:1})]),_:1})]),_:2},1024)]),_:1})]),_:1},8,["data"]),o("div",fa,[t(lt,{"current-page":B.value,"onUpdate:currentPage":e[6]||(e[6]=l=>B.value=l),"page-size":K.value,"onUpdate:pageSize":e[7]||(e[7]=l=>K.value=l),"page-sizes":[10,20,50,100],total:ee.value,layout:"total, sizes, prev, pager, next, jumper",background:"",onSizeChange:Fe,onCurrentChange:Oe},null,8,["current-page","page-size","total"])])]),_:1}),t(U,{modelValue:M.value,"onUpdate:modelValue":e[21]||(e[21]=l=>M.value=l),title:z.value?"编辑用户":"添加用户",width:"600px","destroy-on-close":""},{footer:a(()=>[t(f,{onClick:e[20]||(e[20]=l=>M.value=!1)},{default:a(()=>[...e[50]||(e[50]=[i("取消",-1)])]),_:1}),t(f,{type:"primary",onClick:$e},{default:a(()=>[...e[51]||(e[51]=[i("确定",-1)])]),_:1})]),default:a(()=>[t(ot,{ref_key:"userFormRef",ref:ce,model:d,rules:Se,"label-width":"100px"},{default:a(()=>[t(N,{label:"用户名",prop:"username"},{default:a(()=>[t(b,{modelValue:d.username,"onUpdate:modelValue":e[8]||(e[8]=l=>d.username=l),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),d.userType!=="enterprise"?(L(),q(N,{key:0,label:"姓名",prop:"name"},{default:a(()=>[t(b,{modelValue:d.name,"onUpdate:modelValue":e[9]||(e[9]=l=>d.name=l),placeholder:"请输入姓名"},null,8,["modelValue"])]),_:1})):Y("",!0),d.userType==="enterprise"?(L(),q(N,{key:1,label:"企业名称",prop:"companyName"},{default:a(()=>[t(b,{modelValue:d.companyName,"onUpdate:modelValue":e[10]||(e[10]=l=>d.companyName=l),placeholder:"请输入企业名称"},null,8,["modelValue"])]),_:1})):Y("",!0),d.userType==="enterprise"?(L(),q(N,{key:2,label:"联系人",prop:"contactPerson"},{default:a(()=>[t(b,{modelValue:d.contactPerson,"onUpdate:modelValue":e[11]||(e[11]=l=>d.contactPerson=l),placeholder:"请输入联系人姓名"},null,8,["modelValue"])]),_:1})):Y("",!0),z.value?Y("",!0):(L(),q(N,{key:3,label:"密码",prop:"password"},{default:a(()=>[t(b,{modelValue:d.password,"onUpdate:modelValue":e[12]||(e[12]=l=>d.password=l),type:"password",placeholder:"请输入密码","show-password":""},null,8,["modelValue"])]),_:1})),t(N,{label:"邮箱",prop:"email"},{default:a(()=>[t(b,{modelValue:d.email,"onUpdate:modelValue":e[13]||(e[13]=l=>d.email=l),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1}),d.userType!=="enterprise"?(L(),q(N,{key:4,label:"手机号",prop:"phone"},{default:a(()=>[t(b,{modelValue:d.phone,"onUpdate:modelValue":e[14]||(e[14]=l=>d.phone=l),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1})):(L(),q(N,{key:5,label:"联系人电话",prop:"contactPhone"},{default:a(()=>[t(b,{modelValue:d.contactPhone,"onUpdate:modelValue":e[15]||(e[15]=l=>d.contactPhone=l),placeholder:"请输入联系人电话"},null,8,["modelValue"])]),_:1})),d.userType==="enterprise"?(L(),q(N,{key:6,label:"企业地址",prop:"address"},{default:a(()=>[t(b,{modelValue:d.address,"onUpdate:modelValue":e[16]||(e[16]=l=>d.address=l),placeholder:"请输入企业地址"},null,8,["modelValue"])]),_:1})):Y("",!0),t(N,{label:"用户类型",prop:"userType"},{default:a(()=>[t(F,{modelValue:d.userType,"onUpdate:modelValue":e[17]||(e[17]=l=>d.userType=l),disabled:z.value,placeholder:"请选择用户类型",style:{width:"100%"}},{default:a(()=>[t(T,{label:"个人用户",value:"personal"}),t(T,{label:"企业用户",value:"enterprise"}),t(T,{label:"管理员",value:"admin"})]),_:1},8,["modelValue","disabled"])]),_:1}),t(N,{label:"用户状态",prop:"status"},{default:a(()=>[t(nt,{modelValue:d.status,"onUpdate:modelValue":e[18]||(e[18]=l=>d.status=l)},{default:a(()=>[t(Ve,{label:1},{default:a(()=>[...e[48]||(e[48]=[i("正常",-1)])]),_:1}),t(Ve,{label:0},{default:a(()=>[...e[49]||(e[49]=[i("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(N,{label:"备注"},{default:a(()=>[t(b,{modelValue:d.remark,"onUpdate:modelValue":e[19]||(e[19]=l=>d.remark=l),type:"textarea",rows:3,placeholder:"请输入备注信息"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),t(U,{modelValue:G.value,"onUpdate:modelValue":e[25]||(e[25]=l=>G.value=l),title:"用户详情",width:"700px"},{default:a(()=>[p.value?(L(),Te("div",va,[o("div",ya,[t(he,{size:80,src:p.value.avatar},{default:a(()=>{var l;return[i(u((l=p.value.username)==null?void 0:l.charAt(0)),1)]}),_:1},8,["src"]),o("div",_a,[o("h3",null,u(p.value.username),1),t(j,{type:fe(p.value.userType)},{default:a(()=>[i(u(re(p.value.userType)),1)]),_:1},8,["type"]),t(j,{type:p.value.status===1?"success":"danger",style:{"margin-left":"8px"}},{default:a(()=>[i(u(p.value.status===1?"正常":"已禁用"),1)]),_:1},8,["type"])])]),t(rt),t(it,{column:2,border:""},{default:a(()=>[t(P,{label:"用户ID"},{default:a(()=>[i(u(p.value.id),1)]),_:1}),t(P,{label:"用户名"},{default:a(()=>[i(u(p.value.username),1)]),_:1}),t(P,{label:"邮箱"},{default:a(()=>[i(u(p.value.email),1)]),_:1}),t(P,{label:"手机号"},{default:a(()=>[i(u(p.value.phone),1)]),_:1}),t(P,{label:"用户类型"},{default:a(()=>[i(u(re(p.value.userType)),1)]),_:1}),t(P,{label:"账号状态"},{default:a(()=>[t(j,{type:p.value.status===1?"success":"danger"},{default:a(()=>[i(u(p.value.status===1?"正常":"已禁用"),1)]),_:1},8,["type"])]),_:1}),t(P,{label:"注册时间"},{default:a(()=>[i(u(p.value.createTime),1)]),_:1}),t(P,{label:"最后登录"},{default:a(()=>[i(u(p.value.lastLoginTime||"从未登录"),1)]),_:1}),t(P,{label:"登录次数"},{default:a(()=>[i(u(p.value.loginCount||0)+" 次",1)]),_:1}),t(P,{label:"登录IP"},{default:a(()=>[i(u(p.value.lastLoginIp||"-"),1)]),_:1}),t(P,{label:"备注",span:2},{default:a(()=>[i(u(p.value.remark||"无"),1)]),_:1})]),_:1}),o("div",ba,[t(f,{type:"primary",onClick:e[22]||(e[22]=l=>ve(p.value))},{default:a(()=>[...e[52]||(e[52]=[i("编辑信息",-1)])]),_:1}),t(f,{onClick:e[23]||(e[23]=l=>ye(p.value))},{default:a(()=>[...e[53]||(e[53]=[i("重置密码",-1)])]),_:1}),t(f,{type:p.value.status===1?"danger":"success",onClick:e[24]||(e[24]=l=>Le(p.value))},{default:a(()=>[i(u(p.value.status===1?"禁用账号":"启用账号"),1)]),_:1},8,["type"])])])):Y("",!0)]),_:1},8,["modelValue"]),t(U,{modelValue:W.value,"onUpdate:modelValue":e[26]||(e[26]=l=>W.value=l),title:"登录记录",width:"700px"},{default:a(()=>[t(ke,{data:te.value,style:{width:"100%"}},{default:a(()=>[t(x,{prop:"loginTime",label:"登录时间",width:"180"}),t(x,{prop:"loginIp",label:"登录IP",width:"150"}),t(x,{prop:"location",label:"登录地点"}),t(x,{prop:"device",label:"设备信息"}),t(x,{prop:"status",label:"状态",width:"100"},{default:a(l=>[t(j,{type:l.row.status==="success"?"success":"danger",size:"small"},{default:a(()=>[i(u(l.row.status==="success"?"成功":"失败"),1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])])}}},Ta=dt(wa,[["__scopeId","data-v-eda6b96f"]]);export{Ta as default};
