import{aO as l,A as d,B as h,D as s,aP as p,C as a,z as f,aQ as g}from"./index-3d929bd0.js";const c=l.create({baseURL:"/api",timeout:15e3,headers:{"Content-Type":"application/json"}}),u=()=>typeof window<"u"&&window.location&&window.location.pathname||"/",i=(e="")=>{const r=u();if(String(e).includes("/auth/login")||r.includes("/login"))return;const o=p(r);if(o)a(o);else{const n=f();n?a(n):g(r)}!r.includes("/login")&&typeof window<"u"&&(window.location.href="/login")};c.interceptors.request.use(e=>{const r=u();d(r);const t=h(r);return t&&(e.headers=e.headers||{},e.headers.Authorization=`Bearer ${t}`),e},e=>(console.error("请求错误:",e),Promise.reject(e)));c.interceptors.response.use(e=>{var t;const r=e.data;return r.code&&r.code!==200?(s.error(r.message||"请求失败"),r.code===401&&i(((t=e.config)==null?void 0:t.url)||""),Promise.reject(new Error(r.message||"请求失败"))):r},e=>{var r;if(console.error("响应错误:",e),e.response){const{status:t,data:o}=e.response,n=(o==null?void 0:o.message)||"请求失败";switch(t){case 304:console.warn("收到304响应，可能是缓存问题");break;case 400:s.error(n);break;case 401:s.error(n||"认证失败"),i(((r=e.config)==null?void 0:r.url)||"");break;case 403:s.error("没有权限访问");break;case 404:s.error("请求的资源不存在");break;case 500:s.error("服务器内部错误");break;default:s.error(n)}}else e.request?s.error("网络连接失败，请检查网络"):s.error("请求配置错误");return Promise.reject(e)});export{c as r};
